<?xml version="1.0" encoding="US-ASCII"?>
<!-- edited with XMLSPY v5 rel. 3 U (http://www.xmlspy.com)
     by Daniel M Kohn (private) -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3775 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3775.xml">
<!ENTITY RFC4225 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4225.xml">
<!ENTITY RFC4866 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4866.xml">
<!ENTITY RFC5213 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5213.xml">
<!ENTITY RFC3588 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3588.xml">
<!ENTITY RFC3688 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3688.xml">
<!ENTITY RFC4005 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4005.xml">
<!ENTITY RFC4006 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4006.xml">
<!ENTITY RFC4601 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4601.xml">
<!ENTITY RFC4605 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4605.xml">
<!ENTITY RFC6224 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6224.xml">
<!ENTITY RFC7333 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7333.xml">
<!ENTITY RFC6088 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6088.xml">
<!ENTITY RFC6089 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6089.xml">
<!ENTITY RFC6241 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6241.xml">
<!ENTITY RFC6242 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6242.xml">
<!ENTITY RFC6991 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6991.xml">
<!ENTITY RFC7222 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7222.xml">
    <!ENTITY RFC8040 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8040.xml">
<!ENTITY I-D.bertz-dime-policygroups SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.bertz-dime-policygroups.xml">
<!ENTITY I-D.ietf-dmm-requirements SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-dmm-requirements.xml">
<!ENTITY I-D.ietf-dmm-deployment-models SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-dmm-deployment-models.xml">
<!ENTITY I-D.ietf-netconf-restconf SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-netconf-restconf.xml">
<!ENTITY I-D.ietf-sfc-nsh SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-sfc-nsh.xml">
<!ENTITY I-D.ietf-6man-segment-routing-header SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-6man-segment-routing-header.xml">
<!ENTITY I-D.ietf-spring-segment-routing-mpls SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-spring-segment-routing-mpls.xml">
]>

<rfc category="std" docName="draft-ietf-dmm-fpc-cpdp-10"
     ipr="trust200902">
  <?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

  <?rfc toc="yes" ?>

  <?rfc symrefs="yes" ?>

  <?rfc sortrefs="yes"?>

  <?rfc iprnotified="no" ?>

  <?rfc strict="yes" ?>

  <front>
    <title abbrev="DMM FPC Protocol">Protocol for Forwarding Policy Configuration (FPC) in DMM</title>

     <author fullname="Satoru Matsushima" initials="S." surname="Matsushima">
      <organization abbrev="SoftBank">SoftBank</organization>

      <address>
        <postal>

          <street>1-9-1,Higashi-Shimbashi,Minato-Ku</street>

          <city>Tokyo  105-7322</city>

          <region></region>

          <code></code>

          <country>Japan</country>
        </postal>

        <phone></phone>

        <email>satoru.matsushima@g.softbank.co.jp</email>
      </address>
    </author>

    <author initials="L." surname="Bertz" fullname="Lyle Bertz">
    <organization abbrev="Sprint"></organization>
    <address>
    <postal>
              <street>6220 Sprint Parkway</street>

              <city>Overland Park  KS, 66251</city>

              <region></region>

              <code></code>

              <country>USA</country>
            </postal>

            <phone></phone>

            <email>lylebe551144@gmail.com</email>

    </address>
    </author>

    <author fullname="Marco Liebsch" initials="M." surname="Liebsch">
      <organization abbrev="NEC">NEC Laboratories Europe</organization>

      <address>
        <postal>
          <street>NEC Europe Ltd.</street>

          <street>Kurfuersten-Anlage 36</street>

          <city>D-69115 Heidelberg</city>

          <region></region>

          <code></code>

          <country>Germany</country>
        </postal>

        <phone>+49 6221 4342146</phone>

        <email>liebsch@neclab.eu</email>
      </address>
    </author>

   <author fullname="Sri Gundavelli" initials="S" surname="Gundavelli">
      <organization abbrev="">Cisco</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region>CA</region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <email>sgundave@cisco.com</email>
      </address>
    </author>



<author initials="D." surname="Moses" fullname="Danny Moses">
<organization abbrev="Intel Corporation"></organization>
<address>
<postal>
          <street></street>

          <city></city>

          <region></region>

          <code></code>

          <country></country>
        </postal>

        <phone></phone>

        <email>danny.moses@intel.com</email>

</address>
</author>

    <author fullname="Charles E. Perkins" initials="C.E." surname="Perkins">
       <organization abbrev="Futurewei">Futurewei Inc. </organization>
       <address>
         <postal>
           <street>2330 Central Expressway</street>
           <city>Santa Clara</city>
           <code>95050</code>
           <region>CA</region>
           <country>USA</country>
         </postal>
         <phone>+1-408-330-4586</phone>
         <email>charliep@computer.org</email>
       </address>
    </author>


    <date year="2017" />

    <workgroup>DMM Working Group</workgroup>

    <abstract>
      <t>
        This document describes a way, called Forwarding Policy Configuration
        (FPC) to manage the separation of data-plane and control-plane. FPC
        defines a flexible mobility management system using FPC agent and FPC
        client functions. An FPC agent provides an abstract interface to the
        data-plane. The FPC client configures data-plane nodes by using the
        functions and abstractions provided by the FPC agent for that data-plane
        nodes. The data-plane abstractions presented in this document is
        extensible, in order to support many different types of mobility
        management systems and data-plane functions.
      </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">

        <t>This document describes Forwarding Policy Configuration (FPC), a
        system for managing the separation of data-plane and control-plane. FPC
        enables flexible mobility management using FPC agent and FPC client
        functions. An FPC agent exports an abstract interface to the data-plane.
        To configure data-plane nodes and functions, the FPC client uses the
        interface to the data-plane offered by the FPC agent.</t>

        <t>Control planes of mobility management systems, or other applications
        which require data-plane control, can utilize the FPC client at various
        granularities of operation. The operations are capable of configuring a
        single Data-Plane Node (DPN) directly, as well as multiple DPNs as
        determined by abstracted data-plane models on the FPC agent.</t>

        <t>A FPC agent provides data-plane abstraction in the following three
        areas: </t>

        <t>
        <list style="hanging">
            <t hangText="Topology:"> DPNs are grouped and abstracted according
            to well-known concepts of mobility management such as access
            networks, anchors and domains. A FPC agent provides an interface to
            the abstract DPN-groups that enables definition of a topology for
            the forwarding plane. For example, access nodes may be assigned to a
            DPN-group which peers to a DPN-group of anchor nodes. </t>

            <t hangText="Policy:">
            A Policy embodies the mechanisms for processing specific traffic flows
            or packets. This is needed for QoS, for packet processing to rewrite
            headers, etc. A Policy consists of one or more rules. Each rule is
            composed of Descriptors and Actions. Descriptors
            in a rule identify traffic flows, and Actions apply
            treatments to packets that match the Descriptors in the
            rule. An arbitrary set of policies can be abstracted as a
            Policy-group to be applied to a particular collection of flows, which
            is called the Virtual Port (Vport).</t>

            <t hangText="Mobility:">A mobility session which is active on a mobile node
            is abstracted as a Context with associated runtime
            concrete attributes, such as tunnel endpoints, tunnel
            identifiers, delegated prefix(es), routing information,
            etc. Contexts are attached to DPN-groups along with
            consequence of the control plane. One or multiple Contexts
            which have same sets of policies are assigned Vports which
            abstract those policy sets. A Context can belong to multiple
            Vports which serve various kinds of purpose and policy. Monitors
            provide a mechanism to produce reports when events regarding
            Vports, Sessions, DPNs or the Agent occur.</t>

        </list>
        </t>

        <t>The Agent assembles applicable sets of forwarding policies for the
        mobility sessions from the data model, and then renders those policies
        into specific configurations for each DPN to which the sessions
        attached. The specific protocols and configurations to configure DPN
        from a FPC Agent are outside the scope of this document.</t>

        <t> The data-plane abstractions may be extended to support many
        different mobility management systems and data-plane functions. The
        architecture and protocol design of FPC is not tied to specific types of
        access technologies and mobility protocols. </t>

    </section>

    <!-- <section anchor="pcmodel" title="Reference Architecture and Information Model"> -->

    <section anchor="terminology" title="Terminology">
      <t> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
          "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
          document are to be interpreted as described in <xref
          target="RFC2119"></xref>.</t>

        <t><list hangIndent="24" style="hanging">
            <t hangText="DPN:">A data-plane node (DPN) is capable of
            deploying data-plane features. DPNs may be switches or routers
            regardless of their realiziation, i.e. whether they are hardware
            or software based.</t>

            <t hangText="FPC Agent:"> A functional entity in FPC that
            manages DPNs and provides abstracted data-plane networks to
            mobility management systems and/or applications through FPC
            Clients. </t>

            <t hangText="FPC Client:">A functional entity in FPC that
            is integrated with mobility management systems and/or
            applications to control forwarding policy, mobility sessions
            and DPNs. </t>

            <t hangText="Tenant:">An operational entity that manages
            mobility management systems or applications which require
            data-plane functions. </t>

            <t hangText="Domain:">One or more DPNs that form a
            data-plane network. A mobility management system or an
            application in a tenant may utilize a single or multiple
            domains.</t>

            <t hangText="Virtual Port (Vport):">
                A set of forwarding policies.</t>

            <t hangText="Context:">An abstracted endpoint of a mobility
            session associated with runtime attributes. Vports may
            apply to Context which instantiates those forwarding policies
            on a DPN.
            </t>
        </list></t>

    </section>

    <section anchor="refarch" title="FPC Design Objectives and Deployment">

        <t> To fulfill the requirements described in <xref target="RFC7333"/>,
            FPC enables mobility control-planes and applications to configure
            DPNs with various roles of the mobility management as described
            in <xref target="I-D.ietf-dmm-deployment-models"/>. </t>

        <t> FPC defines building blocks of FPC Agent and FPC Client, as well as
            data models for the necessary data-plane abstractions.  The
            attributes defining those data models serve as protocol elements
            for the interface between the FPC Agent and the FPC Client.</t>

        <t> Mobility control-planes and applications integrate the FPC
            Client function.  The FPC Client connects to FPC Agent functions.
            The Client and the Agent communicate based on information models
            for the data-plane abstractions described in
            <xref target="model1"/>.  The data models allow the control-plane
            and the applications to support forwarding policies on the Agent
            for their mobility sessions. </t>

        <t> The FPC Agent carries out the required configuration and management
            of the DPN(s). The Agent determines DPN configurations according to
            the forwarding policies requested by the FPC Client.  The DPN
            configurations could be specific to each DPN implementation such that
            how FPC Agent determines implementation specific configuration for
            a DPN is outside of the scope of this document. Along with the models,
            the control-plane and the applications put Policies to the Agent
            prior to creating their mobility sessions. </t>

        <t> Once the Topology of DPN(s) and domains are defined for a data
            plane on an Agent, the data-plane nodes (DPNs) are available for
            further configuration. The FPC Agent connects those DPNs to manage
            their configurations.</t>

        <t> This architecture is illustrated in <xref target="fig_refarch"/>.
            An FPC Agent may be implemented in a network controller that handles
            multiple DPNs, or there is a simple case where another FPC Agent
            may itself be integrated into a DPN.</t>

        <t> This document does not adopt a specific protocol for the FPC interface
            protocol and it is out of scope. However it must be capable of
            supporting FPC protocol messages and transactions described in <xref
            target="protocol"/>. </t>


        <t>
        <figure anchor="fig_refarch"
          title="Reference Forwarding Policy Configuration (FPC) Architecture">
            <artwork align="center"><![CDATA[
                    +-------------------------+
                    | Mobility Control-Plane  |
                    |          and            |
                    |      Applications       |
                    |+-----------------------+|
                    ||      FPC Client       ||
                    |+----------^------------+|
                    +-----------|-------------+
        FPC interface protocol  |
                +---------------+-----------------+
                |                                 |
  Network       |                                 |
  Controller    |                      DPN        |
    +-----------|-------------+        +----------|---------+
    |+----------v------------+|        |+---------v--------+|
    ||   [Data-plane model]  ||        ||[Data-plane model]||
    ||       FPC Agent       ||        ||    FPC Agent     ||
    |+-----------------------+|        |+------------------+|
    |+------------+----------+|        |                    |
    ||SB Protocols|FPC Client||        |  DPN Configuration |
    ||   Modules  |  Module  ||        +--------------------+
    |+------^-----+----^-----+|
    +-------|----------|------+
            |          |
  Other     |          | FPC interface
  Southband |          | Protocol
  Protocols |          |
            |          +-----------------+
            |                            |
DPN         |                 DPN        |
 +----------|---------+       +----------|---------+
 |+---------v--------+|       |+---------v--------+|
 ||  Configuration   ||       ||[Data-plane model]||
 || Protocol module  ||       ||     FPC Agent    ||
 |+------------------+|       |+------------------+|
 |                    |       |                    |
 | DPN Configuration  |       |  DPN Configuration |
 +--------------------+       +--------------------+
              ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

        <t> The FPC architecture supports multi-tenancy; an FPC enabled
            data-plane supports tenants of multiple mobile operator networks
            and/or applications. It means that the FPC Client of each tenant
            connects to the FPC Agent and it MUST partition namespace and data
            for their data-planes. DPNs on the data-plane may fulfill multiple
            data-plane roles which are defined per session, domain and
            tenant.</t>

        <t> Note that all FPC models SHOULD be configurable. The FPC interface
            protocol in <xref target="fig_refarch"/> is only required to handle
            runtime data in the Mobility model. The rest of the FPC models,
            namely Topology and Policy, may be pre-configured, and in that case
            real-time protocol exchanges would not be required for them.
            Operators that are tenants in the FPC data-plane could configure
            Topology and Policy on the Agent through other means, such as <xref
            target="I-D.ietf-netconf-restconf">Restconf</xref> or <xref
            target="RFC6241">Netconf</xref>. </t>

    </section>

    <section anchor="model1" title="FPC Mobility Information Model">

    <section anchor="notation" title="Model Notation and Conventions">

    <t>In order to clarify the description of the information model, this draft uses the convention describe in the below.</t>

    <t>Information model entities, e.g. DPNs, Rules, etc., are listed in a hierarchical notation where all entities with the same hierarchical level are located on the same left-justified position one after the other. When entities are composed of sub-entities, they will appear shifted to the right.</t>

    <t>
        <figure anchor="fig-modelnotation"
                  title="Model Notation - An Example">
            <artwork align="center"><![CDATA[
         |             
         +-[entity2]
         |         +-[entity2.1]
         |         +-[entity2.2]
              ]]></artwork>
            <postamble></postamble>
          </figure>
    </t>
 
    <t>Some entities MAY have one or more sub-types placed on the right hand side of the element definition
       in pointing brackets. Common types include:
        <list style="hanging">
            <t hangText="List:">A collection of entities (some could be of the same kind)</t>
            <t hangText="Set:">A collection of entities without duplications</t>
            <t hangText="Name:">a human-readable string</t>
            <t hangText="Key:">a unique value. There are 3 types of keys:
            <list>
            <t hangText="U-Key:">a universally unique key</t>
            <t hangText="G-Key:">a globally unique key - unique within a tenant</t>
            <t hangText="L-Key:">a locally unique key</t>
            </list></t>
        </list></t>

<t>Each entity or its subtype may be optional (O) or mandatory (M). Entities that are not marked as optional are mandatory.</t>

       <t><figure anchor="fig-modelnotation_example">
            <artwork align="center"><![CDATA[
     Example: The following example shows 3 entities:
              - Entity1 is a globally unique key and has an optional, associated Name
              - Entity2 is a list
              - Entity3 is a set and is optional
         +
         | 
         +-[entity1] <G-Key> (M), <Name> (O)
         +-[entity2] <List>
         +-[entity3] <Set> (O)
         |
         +
            ]]></artwork>
             <postamble></postamble>
          </figure>
        </t>


    <t>When expanding entity1 into an information model such as YANG it would result in two values: entity1-GKey and entity1-Name.</t>


    </section>

    <section anchor="corestructure" title="Core Structure - Information Model Components">

    <t>The substructures that comprise the information model are:
    <list style="hanging">
            <t hangText="Topology: ">defines the different DPNs and links between them.</t>
            <t hangText="Policy-Definitions: ">describes how to handle flows: how to identify traffic and what actions are performed on data packets</t>
            <t hangText="Configurable-Policy: ">policies that are relatively static. These policies are usually pre-provisioned and are modified only
                                                 when the network configuration is updated or when new policy rules are configured</t>
            <t hangText="Mobility-Context: "> policies that are created or modified during the network's operation. In most cases, on a per-flow or per session basis</t>
            <t hangText="Monitor: "> a list of events that trigger notification messages from FPC Agents to FPC Clients</t>
    </list></t>

    <t><figure anchor="fig-mobility-core-structure" title="Mobility Information Model - Core Structure">
            <artwork align="center"><![CDATA[
     :
     |
     +-[Mobility]
     |          +
     |          |
     :          +-[Topology]
                |
                +-[Policy]
                |	
                +-[Mobility-Context] <Set>
                |
                +-[Monitor] <Set>
	]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    </section>        <!-- end section Core Structure" -->


    <section anchor="topology" title="Topology">

    <section anchor="topology-substructure" title="Topology Substructure">

    <t>The Topology sub-structure specifies virtual DPNs and the relations between them. It is used by the network
       management entity to select the most appropriate DPN resources for handling specific session flows.</t>

    <t>A virtual DPN is a logical entity that performs DPN functionality (packet movement and management). It may
       represent a physical DPN unit, a sub-function of a physical DPN or a collection of physical DPNs. The motivation
       to refer to virtual DPNs in the information model rather than physical DPNs is to provide flexibility for network
       architects to define which DPN-selection capabilities are performed by the FPC Agent (distributed) and which by the FPC
       client (centralized).</t>

    <t>When a virtual DPN is mapped to a physical DPN, the FPC client has maximum knowledge of the DPN architecture and uses
       it to perform DPN selection for specific sessions. When a virtual DPN is mapped to a collection of physical DPNs, the
       FPC client cannot select a specific physical DPN because it is hidden by the abstraction and only the FPC Agent can
       address the specific associated physical DPNs.</t>

    <t>The Topology sub-structure is comprised of the following sub-structures:
    <list style="hanging">
     <t hangText="DPN-List: "> the list of virtual DPNs in a network configuration.</t>
     <t hangText="DPN-Type-Set: "> a set of DPN-Type entities.</t>
     <t hangText="DPN-Group-List: "> a list of virtual DPNs that supports a specific administrative purpose (in/out bound, roaming,
        subnetwork with common specific configuration etc.)</t>
    </list></t>

    <t><figure anchor="fig-topology-substructure" title="Topology Substructure">
            <artwork align="center"><![CDATA[
        |
        +-[Topology]
        |          +-[DPN] <Set>
        |          +-[DPN-Type] <Set>
                  +-[DPN-Group] <Set>
	   
    ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>


    <section anchor="dpn" title="DPN">

    <t>The DPN list sub-structure specifies a subset of virtual DPNs in the network . It is a list (not a set) since some of
       the DPNs may be identical in functionality.</t>


    <t><figure anchor="fig-dpn-substructure" title="DPN Substructure">
            <artwork align="center"><![CDATA[
        |
        +-[DPN] <List>
        |     +-[DPN-ID] <G-Key>, <Name>
        |     +-[DPN-Resource-Mapping-Reference] 
        |     +-[Interface] <Set>
        |                 +-[Interface-Reference]
        |                 |                     +-[Access-Technology] <U-Key>
        |                 |                     +-[Role] <U-Key>
        |                 |                     +-[Interface-Id] <L-Key>
        |                 +-[Additional-Settings]
    ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    <t>Each DPN entry contains the following information:
    <list style="hanging">
    <t hangText="DPN-Id (Key):"> A unique ID of the virtual DPN</t>
    <t hangText="DPN-Id (Name):">the human-readable display string</t>
    <t hangText="DPN-Resource-Mapping-Reference (O):">A reference to the underlying implementation, e.g. physical node,
       virtual element, etc. that supports this DPN.  This value MUST be non-empty prior to Dynamic-Policies being installed upon the DPN.</t>
    <t hangText="Interface-Set:"> the set of interfaces (through which data packets are received and transmitted) of that Virtual DPN. The virtual DPN
       abstracts one or multiple physical DPNs each having one or more interfaces. The Interface-set sub-structure is a collection of all interface
       types available by this virtual DPN. The purpose of this information is not to describe each interface of each DPN, but rather, to indicate
       the entire set of interface types for the sake of the DPN selection process, when a DPN with specific interface capabilities is required.
       Each interface entry has a reference to a defined DPN-Type entry in the DPN-Type-Set sub-structure defined below and additional information
       that is specific to that interface:
       <list>
       <t>Interface-Reference - a 3-tuple key that uniquely references an entry in the DPN-Type-Set sub-structure: Access-Technology, Role and Interface-Id.</t>
       <t>Additional-Settings - settings of this interface (that do not affect the DPN selection). Examples: MTU size, Sequence number support etc.</t> 
       </list></t>
    </list></t>


    </section> <!-- End section DPN-->


    <section anchor="dpn-type" title="DPN-Type">

    <t>DPN-Type is the collection of all possible types of interfaces defined for DPNs in the network. The interfaces are grouped according
       to their access technology, e.g. 3GPP, WiMAX, 802.x and Role, e.g. LMA, MAG, PGW, AMF etc. Within a group, interfaces may have
       additional properties that are more specific, a list of features and optionally settings relevant to DPN selection. This information
       is used when searching for resources in a network to carry out required operations on data traffic.</t>
    
    <t><figure anchor="fig-dpn-type" title="DPN Type">
            <artwork align="center"><![CDATA[
      |
      +-[DPN-Type] <Set>
      |          +-[Access-Technology] <U-Key>(M),<name>(O)
      |          +-[Role] <U-Key>, <Name> 
                 +-[Interface] <Set>
                             +-[Interface-ID] <L-Key> (M), <Name> (O)
                             +-[Interface-Protocols] <Set> 
                             +-[Features] <Set> 
                             +-[Interface-Settings] <Set> (O)
      ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    <t>Each DPN-Type entry contains the following information:
    <list style="hanging">
    <t hangText="Access-technology: ">the technology used in the access network that originated the signaling (WiMAX, 3GPP, 802.x etc.)</t>
    <t hangText="Role: ">the role (MAG, LMA, PGW, AMF etc.) of the device sharing the interfaces specified below.</t>
    <t hangText="Interface: ">A set of interfaces possible for the group above. Each interface carries the following information:
      <list>
      <t>Interface-ID: a key that is used together with the 2-tuple Access-Technology and Role, to create a 3-tuple key that is referred
         to be the interface definition of virtual DPNs</t>
      <t>Interface-Protocols: rotocols supported by this interface - PMIP, S5-GTP, S5-PMIP etc.</t>
      <t>Features: a set of supported features which further determine the suitability of the interface to the desired operation</t>
      <t>Interface-Settings: an optional set of settings that MUST be known when determining the suitability of an interface for the
         specific request. The difference between 'Features' and 'Settings' is that 'Features' are static while 'Settings' may be configured.
         Examples: SequenceNumber=ON/OFF</t>
      </list></t>
     </list></t>

     <t>The entries Access-Technology and Role represent a tuple key that uniquely identifies the set of interfaces that may be available
        for DPNs of the specific type.</t>

    </section> <!-- End section DPN Type-->


    <section anchor="dpn-group" title="DPN-Group">

    <t>A DPN-Group is a list of a group of DPNs serving some administrative purpose. Each group contains a list of DPNs
       (referenced by DPN-ID) and selected interfaces (referenced by the interface's 3-tuple key). The interfaces are listed
       rather than referred implicitly by each specific DPN to enable to define a subset of a DPN interfaces to be part of the group.</t>

    <t><figure anchor="fig-dpn-group" title="DPN Group">
            <artwork align="center"><![CDATA[
         |
         +-[DPN-Group]
         |           +-[DPN-Group-ID] <G-Key>(M), <Name>(O)
                     +-[Referenced-DPNs] <Set>
                     |                 +-[DPN-ID] <U-Key> <Set>
                     |                          +-[Interface-ID] <L-Key>
                     |                          +-[Role] <U-Key>
                     |                          +-[Access-Technology] <U-Key>
                     |                          +-[DPN-Group-Peer] <Set>
                     +-[DPN-Peer-Group] <Set>                     
                     |                +-[Remote-DPN-Group-ID] <G-key>
                     |                +-[Interface-Settings]  
                     +-[Domain-ID] <L-key>
       ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    </section> <!-- End section DPN Group-->


    </section> <!-- End section Topology Substructure-->


    </section>        <!-- end section Topology -->


    <section anchor="policy" title="Policy">

    <section anchor="policy-substructure" title="Policy Substructure">

    <t>The Policy substructure defines and identifies grouped Rules for enforcement on the data plane. Rules comprise
       traffic descriptors and actions on how to treat traffic in case the traffic descriptor matches a data packet.
       The Policy substructure is independent of a policy context, whether it's an administratively configurable
       policy which applies to all or a defined aggregate of data flows, or a mobility context-related policy, which is
       associated with a mobility session and may apply only to data traffic of an associated mobile node while being registered.</t>

    <t>In addition to the Policy substructure, the Core Structure per <xref target="corestructure"/> holds accordingly
       separate entries for the Configurable-Policy as well as for Mobility-Context, which do not only define their own policies
       by embedded rules, but comprise references to policy definitions in the Policy substructure, to which additional
       settings can be applies on a per-Configurable-Policy basis and on a per-Mobility-Context bases respectively.</t> 

    <t>Traffic descriptions and traffic treatment actions are defined separately in Descriptor-Definition and
       Action-Definition respectively. Binding between traffic descriptors and associated traffic treatment action is
       defined in a set of rule definition entries (Rule-Definition) which comprise references to entries in the set of
       traffic descriptors (Descriptor-Reference) and traffic treatment actions (Action-Reference). Accordingly, a single
       rule or a group of rules are bound to a policy in the set of policy definitions (Policy-Definition) by reference to
       entries in the set of rule definitions (Rule-ID).</t>

 <t><figure anchor="fig-policy-substructure" title="Policy Substructure">
            <artwork align="center"><![CDATA[
      |
      +-[Policy]
      |        +-[Policy-Definition] <Set>
      |        |                   +-[Policy-ID] <G-Key> (M)
      |        |                   +-[Rule-Reference] Set (M)
      |        |                          +-[Precedence] <L-Key> (M)
      |        |                          +-[Rule-ID-Reference] (M)
      |        +-[Rule-Definition] <Set>
      |        |                 +-[Rule-ID] <L-Key> (M)
      |        |                 +-[Descriptor-Match-Type] (M) 
      |        |                 +-[Descriptor-Reference] <Set>
      |        |                 |                      +-[Descriptor-ID-Reference] 
      |        |                 |                      +-[Direction]
      |        |                 +-[Action-Reference] <Set>
      |        |                                    +-[Action-ID-Reference] 
      |        |                                    +-[Action-Order]
      |        +-[Descriptor-Definition] <Set>
      |        |                   +-[Descriptor -ID] <L-Key> (M)
      |        |                   +-[Descriptor-Type]
      |        |                   +-[Descriptor-Value]
      |        +-[Action-Definition] <Set>
      |                            +-[Action-ID] <L-Key> (M)
      |                            +-[Action-Type]
      |                            +-[Action-Value] 
      |
      ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    <t>The Policy Substructure contains the following entries:
    <list style="hanging">
    <t hangText="Policy-Definition: ">A set of policy definitions which bind a single or multiple rules to a policy.
    <list>
    <t hangText="Policy-ID: ">Identifies a policy definition.</t>
    <t hangText="Rule-Reference: ">Assigns a set of rule definitions, which are bound to a policy definition, by reference
       to the associated Rule in the Rule-Definition Substructure.</t>
    <t hangText="Precedence: ">Defines the order with which the rules must be applied.</t>
    <t hangText="Rule-ID-Reference: ">Identifies a rule.</t>
    </list></t>
    <t hangText="Rule-Definition: ">A set of rule definitions which bind a single or multiple traffic descriptors
       (by reference to Descriptor-Definition) to a single or multiple traffic treatment actions (by reference to Action-Definition).
    <list>
    <t hangText="Rule-ID: ">Identifies a rule definition.</t>
    <t hangText="Descriptor-Match-Type: ">Conjuction of Descriptor-Values to apply as match to DPN traffic, which can be either
       OR or AND. The identified conjunction applies to all Descriptor-Definitions in the given Rule-Definition.</t>
    <t hangText="Descriptor-Reference: ">Assigns a set of descriptors to the rule by reference to the associated Descriptor-Definition.</t>
    <t hangText="Descriptor-ID-Reference: ">Identifies the referred Descriptor-Definition</t>
    <t hangText="Direction: ">Indicates if a rule applies to uplink traffic, to downlink traffic, or to both, uplink- and downlink traffic.
       Applying a rule to both, uplink- and downlink traffic, in case of symmetric rules, allows omitting a separate entry for each direction.</t>
    <t hangText="Action-Reference: ">Assigns a set of actions to the rule by reference to the associated Action-Definition.</t>
    <t hangText="Action-ID-Reference: ">Identifies the referred Action-Definition.</t>
    <t hangText="Action-Order: ">Defines the order how actions are executed in case the rule applies per match of the associated traffic descriptor.</t>
    </list></t>
    <t hangText="Descriptor-Definition: ">A set of descriptor definitions, each being identified by a key (Descriptor-ID)
    <list>
    <t hangText="Descriptor-ID: ">Identifies a descriptor definition.</t>
    <t hangText="Descriptor-Type: ">Identifies the type of descriptor, e.g. an IPv6 traffic selector per [RFC 6088], for unambiguous
2      interpretation of a Descriptor-Value.</t>
    <t hangText="Descriptor-Value: ">Defines all required attribute-value pairs per the traffic descriptor type identified in Descriptor-Type.</t>
    </list></t>
    <t hangText="Action-Definition: ">A set of action definitions.
    <list>
    <t hangText="Action-ID: ">Identifies an action definition.</t>
    <t hangText="Action-Type: ">Identifies the type of an action for unambiguous interpretation of an Action-Value entry.</t>
    <t hangText="Action-Value: ">Defines all required attribute-value pairs per the action type identified in Action-Type.</t>
    </list></t>
    </list></t>


    </section> <!-- End policy substructure -->


    <section anchor="config-policy" title="Configurable Policy">

    <t><figure anchor="fig-configurable-policy" title="Configurable Policy">
            <artwork align="center"><![CDATA[
      |
      +-[Configurable-Policy] <Set>
      |                     +-[DPN-ID-Reference] <U-Key>
      |                     +-[Installed-Policy] <List>                   
      |                     |                  +-[Installed-DPN-Policy-ID] <G-Key>
      |                     |                  +-[Policy-ID-Reference]
      |                     |                  +-[Policy-Settings]
      |                     +-[Settings]
      |
     ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

    <t>The Configurable-Policy Substructure contains the following entries:
    <list style="hanging">
    <t hangText="DPN-ID-Reference: ">Refers to the DPN to which the policy applies.</t>
    <t hangText="Installed-Policy: ">A list of policies that apply to an identified DPN.
    <list>
    <t hangText="Installed-DPN-Policy-ID: ">Holds the identifier of the DPN at which the policy has been installed.</t>
    <t hangText="Policy-ID-Reference: ">Assigns a policy by reference to the associated Policy-Definition.</t>
    <t hangText="Policy-Settings: ">Settings that apply to the previously referenced policy to complement rules or
      make them concrete, e.g. in case the descriptor representing a packet match has not or unambiguously been defined
      in the poliicy sub-structure.</t>
    </list></t>
    <t hangText="Settings: ">Settings that apply to multiple policies at the identified DPN.</t>
    </list></t>

    </section>


    </section> <!-- end section Policy-->

    <section anchor="mobility" title="Mobility-Context">

   <t>The Mobility-Context Substructure holds entries associated with a mobile node's mobility sessions. At least one instance 
      is created at the mobile node's registration to serve as parent context. Additional instances holding child context with
      reference to parent context can be created. Child context holds, for example, descriptors of mobile node data traffic which needs
      to be treated different from traffic that matches descriptor of the parent context, e.g. in terms of QoS. Child context can
      inherit some attributes/values from parent context, such as traffic encapsulation and forwarding information, but can hold different
      or additional attributes/values that apply to traffic that matches the descriptor of the child context.</t>

    <t>Termination a parent context implies termination of all dependent child context, e.g. at deregistration of a mobile node.</t>

   <t><figure anchor="fig-mobility-context" title="Mobility Context">
            <artwork align="center"><![CDATA[
      |
      +-[Mobility-Context] <Set>
      |                  +-[Mobility-Context-ID] <U-Key>
      |                  +-[DPN-Group-ID-Reference] (O)
      |                  +-[Parent-Mobility-Context-ID-Reference] (O)
      |                  +-[DPN-References] <List>
      |                  |                +-[DPN-ID-Reference] 
      |                  |                +-[Direction] 
      |                  |                +-[DPN-Settings-Complementary]
      |                  |                +-[Interface-ID-Reference] 
      |                  |                +-[Embedded-Rule] set <concrete>
      |                  |                +-[Assigned-Policy-Reference] <Set> 
      |                  +-[Requested-Policy-Reference] <Set>
      |                  +-[Context-Settings-Complementary]
    ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

  <t>The Mobility-Context Substructure holds the following entries:
    <list style="hanging">
    <t hangText="Mobility-Context-ID: ">Identifies a Mobility-Context</t>
    <t hangText="DPN-Group-ID-Reference: ">Assigns a DPN-Group, which groups DPN that are used during the DPN selection procedure, by reference.</t>
    <t hangText="Parent-Mobility-Context-ID-Reference: ">Assigns a parent Mobility-Context to aquire settings as required.</t>
    <t hangText="DPN-References: ">Holds a list of DPNs with the associated concrete policies that apply to the DPN.
    <list>
    <t hangText="DPN-ID-Reference: ">Assigns a DPN, to which the policy applies, by reference.</t>
    <t hangText="Direction: ">Indicates if a rule applies to uplink or downlink traffic, or to both, uplink- and downlink traffic. Applying a
       rule to both, uplink- and downlink traffic, in case of symmetric rules, allows omitting a separate entry for each direction.</t>
    <t hangText="DPN-Settings-Complementary: ">Complementary seeings that apply to the DPN for the given Mobility-Context.</t>
    <t hangText="Interface-ID-Reference: ">Assigns the selected interface of the DPN my reference.</t>
    <t hangText="Embedded-Rule: ">Rule that applies to the DPN for this Mobility-Context. This rule is embedded and not refereced in the
       Policy substructure.</t>
    <t hangText="Assigned-Policy-Reference: ">A set of references to the list of Requested-Policy-References per this Mobility-Context.</t>
    </list></t>
    <t hangText="Requested-Policy-Reference: ">Assigns a list of policies in Policy-Definitions that can apply to any DPN per this Mobility-Context.
      DPN-Reference entries can select from this list of policy references to apply to the associated DPN.</t>
    <t hangText="Context-Settings-Complementary: ">Complementary settings that apply to the referenced policies per this Mobility-Context.</t>
    </list></t>

    </section> <!-- End mobility context -->

    <section anchor="rule-template" title="Rule Template">

    <t>The Rules Template format is aligned with the Rule Substructure. It can represent an Embedded-Rule
       per the Mobility-Context Substructure.</t>

    <t><figure anchor="fig-rules-template" title="Rule Template">
            <artwork align="center"><![CDATA[
     |
     +-[Embedded-Rule] <List>
     |               +-[Rule-ID]
     |               +-[Precedence] <L-Key>
     |               +-[Descriptor-Match-Type] (M)
     |               +-[Descriptor-Definition] <Set>
     |               |                       +-[Descriptor-ID] <L-Key> (M)
     |               |                       +-[Descriptor-Type]
     |               |                       +-[Descriptor-Value]
     |               +-[Action-Definition] <Set>
     |                                   +-[Action-ID] <L-Key> (M)
     |                                   +-[Action-Type]
     |                                   +-[Action-Value]
    ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

<t>The Embedded-Rule template holds the following entries:
    <list style="hanging">
    <t hangText="Rule-ID: ">Identifies a rule definition</t>
    <t hangText="Precedence: ">Defines the order with which the rules must be applied</t>
    <t hangText="Descriptor-Match-Type: ">Conjuction of Descriptor-Values to apply as match to DPN traffic,
                                          which can be either OR or AND. The identified conjunction applies
                                          to all Descriptor-Definitions in the given Rule-Definition</t>
    <t hangText="Descriptor-Definition: ">A set of descriptor definitions, each being identified by a key (Descriptor-ID)
    <list>
    <t hangText="Descriptor-ID: ">Identifies a Descriptor-Definition</t>
    <t hangText="Descriptor-Type: ">Identifies the type of descriptor, e.g. an IPv6 traffic selector per [RFC 6088], for
                                    unambiguous 2 interpretation of a Descriptor-Value</t>
    <t hangText="Descriptor-Value: ">Defines all required attribute-value pairs per the traffic descriptor type identified
                                     in Descriptor-Type.</t>
    </list></t>
    <t hangText="Action-Definition: ">A set of action definitions.
    <list>
    <t hangText="Action-ID: ">Identifies an action definition.</t>
    <t hangText="Action-Type: ">Identifies the type of an action for unambiguous interpretation of an Action-Value entry.</t>
    <t hangText="Action-Value: ">Defines all required attribute-value pairs per the action type identified in Action-Type.</t>
    </list></t>
    </list></t>





    </section>  <!-- End embeddable-rule -->
 


   <section anchor="monitor_overview" title="Monitors">
        <t> Monitors provide a mechanism to produce reports when events
            occur. A Monitor will have a target that specifies what is to
            be watched. </t>
        <t> When a Monitor is specified, the configuration MUST be applicable
            to the attribute/entity monitored. For example, a Monitor using a
            Threshold configuration cannot be applied to a Context, because
            Contexts do not have thresholds. But  such a monitor could be
            applied to a numeric threshold property of a Context. </t>
        <t>
        <figure anchor="fig-monitor"
                  title="Monitor Substructure">
            <artwork align="center"><![CDATA[
       |
       +-[Monitor] <List>
       |         +-[Monitor-ID] <U-Key>
       |         +-[Target]
       |         +-[Binding-Information] (O)
       |         +-[Deterrable]
       |         +-[Configuration]
              ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>

        <t><list style="hanging">
        <t hangText="Monitor-id:"> Name of the Monitor. The ID format MUST conform to <xref target="naming"></xref>.</t>
        <t hangText="Target:"> Description of what is to be monitored. This can be an Event, a Dynamic Policy, an installed DPN Policy,
              or values of a Dynamic-Policy attribute. When the type is an attribute of Mobility-Context, the target name
              is a concatenation of the Context-Id and the relative path (separated by '/') to the attribute(s) to be monitored. 
              Target must provide unambiguously identify the monitored attribute and the location (DPN).</t>
        <t hangText="Binding-Information:"> Complements (ambigous) Target information to define the Monitor in an unambigous way.</t>
        <t hangText="Deterrable: "> Indicates that a monitoring report can be delayed in a defined delay budget for possible bundling with other reports</t>
        <t hangText="Configuration:"> Determined by the Monitor subtype. The recipient of a notification as monitor report is specified
              in the Configuration. Four reporting types are defined:
              <list style="symbols">
                  <t>Periodic reporting specifies an interval by which a notification is sent.</t>
                  <t>Event reporting specifies a list of event types that, if they occur and are related to the monitored
                  attribute, will result in sending a notification.</t>
                  <t>Scheduled reporting specifies the time (in seconds since Jan 1, 1970) when a notification for the monitor should
                  be sent. Once this Monitor's notification is completed the Monitor is automatically de-registered.</t>
                  <t>Threshold reporting specifies one or both of a low and high threshold. When these values are crossed a
                  corresponding notification is sent.</t>
              </list>
            </t>
        </list></t>

    </section>        <!-- end section title="Monitors"  -->


    <section anchor="naming" title="Namespace and Format">

    </section>        <!-- end section title="Namespace and Format"  -->

    <section anchor="attr_application" title="Attribute Application">


    </section>        <!-- end section title="Attribute Application"  -->

</section>        <!-- end section title="Information Model"  -->


<section anchor="protocol" title="Protocol">
<t>NOTE - The terms Context and Mobility-Context are used interchangeable 
throughout the rest of this document.</t>
  <section anchor="messageandsematics" title="Protocol Messages and Semantics">
    <t>Five message types are supported:</t>
<texttable anchor="messages" title="Client to Agent Messages">
    <ttcol align="left">Message</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>CONF</c>
    <c>HEADER OP_TYPE BODY</c>
    <c>Configure processes a single operation.</c>

    <c>CONF_BUNDLE</c>
    <c>HEADER OP_TYPE REF_SCOPE TRANS_STRATEGY 1*[OP_ID BODY]</c>
    <c> A Conf-bundle takes multiple operations that are to be executed as a
    group with partial failures allowed. They are executed according to the
    OP_ID value coupled with the BODY in ascending order. If a CONF_BUNDLE
    fails, any entities provisioned in the CURRENT operation are removed.
    However, any successful operations completed prior to
    the current operation are preserved in order to reduce system load.</c>

    <c> REG_MONITOR</c>
    <c> HEADER *[ MONITOR ]</c>
    <c> Register a monitor at an Agent. The message includes information about
    the attribute to monitor and the reporting method.  Note that a
    MONITOR_CONFIG is required for this operation.</c>

    <c> DEREG_MONITOR</c>
    <c> HEADER 1*[ MONITOR_ID ] [ SEND_DATA ]</c>
    <c> Deregister monitors from an Agent. Monitor IDs are provided. SEND_DATA is
    an optional boolen that indicates if a successful DEREG triggers a NOTIFY with
    final data.</c>

    <c> PROBE</c>
    <c> HEADER MONITOR_ID</c>
    <c> Probe the status of a registered monitor.</c>
    </texttable>
    <t> Each message contains a header with the Client Identifier, an execution
    delay timer and an operation identifier. The delay, in ms, is processed
    as the delay for operation execution from the time the operation is
    received by the Agent.</t>

    <t> The Client Identifier is used by the Agent to associate specific
    configuration characteristics, e.g. options used by the Client when
    communicating with the Agent, as well as the association of the Client
    and tenant in the information model.</t>

    <t> CONF_BUNDLE also has the Transaction Strategy (TRANS_STRATEGY)
    attribute.  This value specifies the behavior of the Agent when an
    operation fails while processing a CONF_BUNDLE message.  The value of
    'default' uses the default strategy defined for the message.  The value
    'all_or_nothing' will roll back all successfully executed operations
    within the bundle as well as the operation that failed.</t>

    <t> An FPC interface protocol used to support this
    specification may not need to support CONF_BUNDLE messages or specific
    TRANS_STRATEGY types beyond 'default' when the protocol provides
    similar semantics.  However, this MUST be clearly defined in the
    specification that defines the interface protocol.</t>

    <t> An Agent will respond with an ERROR, OK, or an OK WITH INDICATION that
    remaining data will be sent via a notify from the Agent to the Client
    <xref target="asyncnotification"/> for CONFIG and CONF_BUNDLE requests.
    When returning an 'ok' of any kind, optional data MAY be present.</t>
    <t>Two Agent notifications are supported:</t>
    <texttable anchor="notifications"
            title="Agent to Client Messages (notifications)">
      <ttcol align="left">Message</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Description</ttcol>

      <c>CONFIG_RESULT_NOTIFY</c>
      <c>See <xref target="ayncnotify_detail"/></c>
      <c>An asynchronous notification from Agent to Client based upon a
    previous CONFIG or CONF_BUNDLE request.</c>

      <c>NOTIFY</c>
      <c>See <xref target="notify_structs"/></c>
      <c>An asynchronous notification from Agent to Client based upon a
    registered MONITOR.</c>
    </texttable>
    
    <t>The HEADER is a part of all messages and is comprised of the following information:
    <list hangIndent="4" style="hanging">
    	<t hangText="CLT_ID:"> The Client Identifier </t>
    	<t hangText="DELAY (OPTIONAL):"> The time (in ms) to delay the execution of ther operaiton
    	 on the DPN once it is received by the Agent.</t>
    	<t hangText="OP_ID:"> Operation Identifier</t>
    </list>
    </t>
    

    <t>Results will be supplied per operation input. Each result contains the
      RESULT_STATUS and OP_ID that it corresponds to. RESULT_STATUS values are:
      <list>
      <t> OK - Success </t>
      <t> ERR - An Error has occurred </t>
      </list>
    </t>
    <t> If an error occurs, information MUST be returned in the response.  Error informaiton 
    is comprised of the following:
    <list>
    <t> ERROR_TYPE_ID (Unsigned 32, REQUIRED) - The identifier of a specific
        error type The values are TRANSPORT (0), RPC (1), PROTOCOL(2) or 
        APPLICATION (3).</t>
    <t> ERROR_TAG - (String, REQUIRED) - enumerated error tag.</t>
    <t> ERROR_APP_TAG - (String, OPTIONAL) - Application specific error tag.</t>
    <t> ERROR_MESSAGE - (String, OPTIONAL) - A message describing the error.</t>
    <t> ERROR_INFO - (Any Data, OPTIONAL) - Any data required for the response.</t>
    </list>
    </t>
    
  <section anchor="conf-processing" title="CONFIG and CONF_BUNDLE Messages">
    <t>CONFIG and CONF_BUNDLE include OP_TYPE as part of the header information:
    <list hangIndent="4" style="hanging">
      <t hangText="OP_TYPE:"> specifies the type of operation. Valid values
    are 'create' (0), 'update' (1), 'query' (2) or 'delete' (3).</t>
    </list></t>
    
    <t>The BODY is comprised of the following information:
    <list hangIndent="4" style="hanging">
      <t hangText="COMMAND_SET:"> Specifies the Command Set (see <xref target="commandsets"/>).</t>
	  <t hangText="REF_SCOPE:"> If supported, specifies the Reference Scope (see <xref target="refscope"/>)</t>
      <t hangText="BODY INTERNALS:"> A list of entities under Policy, e.g. Policy-Definitions,
      Action-Definitions, etc. as well as Installed Policies and Contexts
    when the OP_TYPE is 'create' or 'update'.  Otherwise it is a list of
    Targets for 'query' or 'deletion'.  See <xref target="op-body"/>
        for details.</t>
    </list>
    </t>
<t>CONF_BUNDLES includes an OP_ID with each body for tracking of the bundle's subtransactions.</t>
    <section anchor="agent-processing" title="Agent Operation Processing">
      <t>The Agent will process entities provided in an operation in the
    following order:
        <list style="numbers">
    <t>Action-Definitions</t>
    <t>Descriptor Defintions</t>
    <t>Rule Definitions</t>
    <t>Policy Definitions</t>
    <t>Installed Policies</t>
    <t>Mobility Contexts according to COMMAND_SET</t>
    </list></t>
    </section>
    <section anchor="commandsets" title="Command Bitsets">
    <t> The COMMAND_SET is a technology specific bitset that allows for a
    single entity to be sent in an operation with multiple requested
    sub-transactions to be completed. It can also provide clarity for a request.
    For example, a Mobility-Context could have
    the Home Network Prefix absent but it is unclear if the Client would
    like the address to be assigned by the Agent or if this is an error.
    Rather than creating a specific command for assigning the IP a bit
    position in a COMMAND_SET is reserved for Agent based IP assignment.</t>
    </section>
    <section anchor="refscope" title="Reference Scope">
    <t> The Reference Scope is an optional feature that provides the scope of
    references used in a configuration command, i.e. CONFIG or
    CONF_BUNDLE. These scopes are defined as
    <list style="symbols">
    <t> none - All entities have no references to other entities.</t>
        <t> op - All references are contained in the operation body, i.e. only
        intra-operation references exist.</t>
        <t> bundle - All references exist in bundle
        (inter-operation/intra-bundle). NOTE - If this value is present in
        a CONFIG message it is equivalent to 'op'.</t>
        <t> storage - One or more references exist outside of the operation
        and bundle. A lookup to cache / storage is required.</t>
        <t> unknown - the location of the references are unknown. This is
        treated as a 'storage' type.</t>
    </list></t>
    <t> An agent that only accepts 'op' or 'bundle' reference scope messages
    is referred to as 'stateless' as it has no direct memory of references
    outside messages themselves. This permits low memory footprint Agents.
    Even when an Agent supports all message types an 'op' or 'bundle'
    scoped message can be processed quickly by the Agent as it does not
    require storage access. </t>
    </section>
    <section anchor="response" title="Operation Response">
      <section anchor="immediateresp" title="Immediate Response">
    <t>For CONF and CONF_BUNDLE the Response MAY include the the following:
      <list>
      <t> NOTIFY_FOLLOWS - A boolean indicator that the Operation has been accepted by the Agent
      but further processing is required. A CONFIG_RESULT_NOTIFY will be
      sent once the processing has succeeded or failed.</t>
      <t>ENTITIES - Optionally, entities created or partially fulfilled as part of 
      the operation as specified in <xref target="op_respbody"/> For Clients that need 
      attributes back quickly for call processing, the AGENT MUST respond back with an
      OK_NOTIFY_FOLLOWS and minimally the attributes assigned by the Agent
      in the response.  These situations MUST be determined through the use
      of Command Sets (see <xref target="commandsets"/>).</t>
      </list>
    </t>
    </section>

    <section anchor="asyncnotification" title="Asynchronous Notification">
    <t> A CONFIG_RESULT_NOTIFY occurs after the Agent has completed processing
    related to a CONFIG or CONF_BUNDLE request. It is an asynchronous
    communication from the Agent to the Client.</t>

    <t> The values of the CONFIG_RESULT_NOTIFY are detailed in
    <xref target="ayncnotify_detail"/>.</t>
    </section>
  </section>
</section>

<section anchor="monitor_descr" title="Monitors">
  <t>An Agent may reject a registration if it or the DPN has insufficient
      resources.</t>
  <t> An Agent or DPN may temporarily suspend monitoring if insufficient
      resources exist.  In such a case the Agent MUST notify the
      Client.</t>

	<t>When a monitor has a reporting configuration of SCHEDULED it
      is automatically de-registered after the last NOTIFY occurs. </t>
      
  <t> If a SCHEDULED or PERIODIC configuration is
      provided during registration with the time related value (time
      or period respectively) of 0 a NOTIFY is sent and
      the monitor is immediately de-registered. This method should, when a
      MONITOR has not been installed, result in an immediate NOTIFY sufficient
      for the Client's needs and lets the Agent realize the Client has
      no further need for the monitor to be registered. </t>

  <t> PROBE messages are also used by a Client to retrieve information about a
      previously installed monitor. The PROBE message SHOULD identify
      one or more monitors by means of including the associated
      monitor identifier. An Agent receiving a PROBE message
      sends the requested information in a single or multiple NOTIFY
      messages.</t>
      
<t>If the Monitor configuration associated with a NOTIFY is deterrable then 
the NOTIFY MAY be bundled with other messages back to the Agent even if this results
in a delay of the NOTIFY.</t>
  <section anchor="asyncmonitornotification" title="Asynchronous Notification">
    <t> A NOTIFY can be sent as part of de-registraiton, a trigger based upon a
    Monitor Configuration or a PROBE.   A NOTIFY is comprised of unique
    Notification Identifier from the Agent, the Monitor ID the notification
    applies to, the Trigger for the notification, a timestamp of when the
    notification's associated event occurs and data that is specific to
    the monitored value's type.</t>
  </section>
  </section>
</section>

<section anchor="protoperation" title="Protocol Operation">
  <section anchor="simple" title="Simple RPC Operation">
  <t> An FPC Client and Agent MUST identify themselves using the CLI_ID and
      AGT_ID respectively to ensure that for all transactions a recipient of
      an FPC message can unambiguously identify the sender of the FPC message.
<!--  All messages between an Agent and a Client must identify the Client and
      Agent using the CLI_ID and AGT_ID respectively.-->
      A Client MAY direct the Agent to enforce a rule in a particular DPN by
      including a DPN_ID value in a Context. Otherwise the Agent selects a
      suitable DPN to enforce a Context and notifies the Client about the
      selected DPN using the DPN_ID.</t>

  <t> All messages sent from a Client to an Agent MUST be acknowledged by the
      Agent. The response must include all entities as well as status
      information, which indicates the result of processing the message, using
      the RESPONSE_BODY property. In case the processing of the message results
      in a failure, the Agent sets the ERROR_TYPE and ERROR_TAG
      accordingly and MAY clear the entity, e.g. Context or Installed-Policy, which caused the failure,
      in the response.</t>

  <t> If based upon Agent configuration or the processing of the request
      possibly taking a significant amount of time the Agent MAY respond with
      a NOTIFY_FOLLOWS indicaiton with an optional RESPONSE_BODY containing the
      partially completed entities. When a NOTIFY_FOLLOWS indication is indicated, the
      Agent will, upon completion or failure of the operation, respond with
      an asynchronous CONFIG_RESULT_NOTIFY to the Client.</t>

  <t> A Client MAY add a property to a Context without providing all required
      details of the attribute's value. In such case the Agent SHOULD determine
      the missing details and provide the completed property description back
      to the Client. If the processing will take too long or based upon Agent
      configuration, the Agent MAY respond with an OK that indicates a NOTIFY_FOLLOWS and also
      includes a 
      RESPONSE_BODY containing the partially completed entities.</t>

  <t> In case the Agent cannot determine the missing value of an attribute's
      value per the Client's request, it leaves the attribute's value cleared
      in the RESPONSE_BODY and sets the RESULT to Error, ERROR_TYPE and
      ERROR_TAG. As example, the Control-Plane needs to setup a tunnel
      configuration in the Data-Plane but has to rely on the Agent to determine
      the tunnel endpoint which is associated with the DPN that supports the
      Context. The Client adds the tunnel property attribute to the FPC message
      and clears the value of the attribute (e.g. IP address of the local
      tunnel endpoint). The Agent determines the tunnel endpoint and includes
      the completed tunnel property in its response to the Client.</t>

  <t> <xref target="fig_msc_example"></xref> illustrates an exemplary session
      life-cycle based on Proxy Mobile IPv6 registration via MAG Control-Plane
      function 1 (MAG-C1) and handover to MAG Control-Plane function 2 (MAG-C2).
      Edge DPN1 represents the Proxy CoA after attachment, whereas Edge DPN2
      serves as Proxy CoA after handover. As exemplary architecture, the FPC
      Agent and the network control function are assumed to be co-located with
      the Anchor-DPN, e.g. a Router.  </t>
  <t>
  <figure anchor="fig_msc_example"
          title="Exemplary Message Sequence (focus on FPC reference point)">
        <artwork align="center"><![CDATA[
                                              +-------Router--------+
                        +-----------+         |+-------+ +---------+|
+------+ +------+     +-----+ FPC   |          | FPC   | |  Anchor |
|MAG-C1| |MAG-C2|     |LMA-C| Client|          | Agent | |   DPN   |
+------+ +------+     +-----+-------+          +-------+ +---------+
[MN attach]  |            |                          |           |
   |-------------PBU----->|                          |           |
   |         |            |---(1)--CONFIG(CREATE)--->|           |
   |         |            |   [ MOBILTY_CONTEXT_ID,  |--tun1 up->|
   |         |            | DPNREFLIST:[[DPN1, BOTH  |           |
   |         |            |  DPN_SETTINGS_COMPL:[    |           |
   |         |            |   DOWNLINK(QOS/TUN),     |           |
   |         |            |   UPLINK(QOS/TUN)] ]]    |--tc qos-->|
   |         |            |   CTXT_SETTINGS_COMPL:[  |           |
   |         |            |     IP_PREFIX(HNP) ] ]   |           |
   |         |            |<---(2)- OK --------------|-route add>|
   |         |            |                          |           |
   |<------------PBA------|                          |           |
   |         |            |                          |           |
   | +----+  |            |                          |           |
   | |Edge|  |            |                          |           |
   | |DPN1|  |            |                          |           |
   | +----+  |            |                          |           |
   |   |                                                         |
   |   |-=======================================================-|
   |                      |                          |           |
   |   [MN handover]      |                          |           |
   |         |---PBU ---->|                          |           |
   |         |            |--(3)- CONFIG(MODIFY)---->|           |
   |         |<--PBA------|    [ MOBILTY_CONTEXT_ID  |-tun1 mod->|
   |         |            | DPNREFLIST:[[DPN1, BOTH  |           |
   |         |            |    DPN_SETTINGS_COMPL:[  |           |
   |         |            |   DOWNLINK(TUN),         |           |
   |         |  +----+    |   UPLINK(TUN)] ]] ]      |           |
   |         |  |Edge|    |<---(4)- OK --------------|           |
   |         |  |DPN2|    |                          |           |
   |         |  +----+    |                          |           |
   |         |    |       |                          |           |
   |         |    |-============================================-|
   |         |            |                          |           |

      ]]></artwork>
        <postamble></postamble>
      </figure>
  </t>

  <t> After reception of the Proxy Binding Update (PBU) at the LMA
      Control-Plane function (LMA-C), the LMA-C selects a suitable DPN, which
      serves as Data-Plane anchor to the mobile node's (MN) traffic. The
      LMA-C adds a new logical Context to the DPN to treat the MN's
      traffic (1) and includes a Context Identifier (CONTEXT_ID) to the
      CONFIG command. The LMA-C identifies the selected Anchor DPN by
      including the associated DPN identifier and the Direction the entry applies to, BOTH.</t>

  <t> The LMA-C adds properties during the creation of the new Context. One
      property is added to the DPN Settings Complimentary, to specify the forwarding tunnel type and endpoints
      (Anchor DPN, Edge DPN1) in each direction (as required). Another
      property is added to specify the QoS differentiation, which the MN's
      traffic should experience. At reception of the Context, the FPC Agent
      utilizes local configuration commands to create the tunnel (tun1) as
      well as the traffic control (tc) to enable QoS differentiation. After
      configuration has been completed, the Agent applies a new route to
      forward all traffic destined to the MN's HNP specified as a property
      in the Context's Complementary Settings and applied the configured tunnel interface (tun1).</t>

  <t> During handover, the LMA-C receives an updating PBU from the handover
      target MAG-C2. The PBU refers to a new Data-Plane node (Edge DPN2) to
      represent the new tunnel endpoints in the downlink and uplink, as
      required.  The LMA-C sends a CONFIG message (3) to the Agent to
      modify the existing tunnel property of the existing Context and to update
      the tunnel endpoint from Edge DPN1 to Edge DPN2. Upon reception of the
      CONFIG message, the Agent applies updated tunnel property to the local
      configuration and responds to the Client (4).</t>

  <t>
    <figure anchor="fig_msc_delete_example"
            title="Exemplary Message Sequence (focus on FPC reference point)">
        <artwork align="center"><![CDATA[
                                              +-------Router--------+
                        +-----------+         |+-------+ +---------+|
+------+ +------+     +-----+ FPC   |          | FPC   | |  Anchor |
|MAG-C1| |MAG-C2|     |LMA-C| Client|          | Agent | |   DPN   |
+------+ +------+     +-----+-------+          +-------+ +---------+
[MN attach]  |            |                          |           |
   |-------------PBU----->|                          |           |
   |         |            |---(1)--CONFIG(MODIFY)--->|           |
   |<------------PBA------|   [ CONTEXT_ID,          |--tun1   ->|
   |         |            | DPNREFLIST:[[DPN1, BOTH |           |
   |         |            |    DPN_SETTINGS_COMPL:[  |           |
   |         |            |   DOWNLINK(TUN delete),  |    down   |
   |         |            | UPLINK(TUN delete)] ]] ] |           |
   |         |            |                          |           |
   |         |            |<-(2)- OK ----------------|           |
   |         |            |                          |           |
   |         |  [ MinDelayBeforeBCEDelete expires ]  |           |
   |         |            |                          |           |
   |         |            |---(3)--CONFIG(DELETE)--->|-- tun1 -->|
   |         |            |                          |  delete   |
   |         |            |<-(4)- OK ----------------|           |
   |         |            |                          |-- route ->|
   |         |            |                          |   remove  |
   |         |            |                          |           |
      ]]></artwork>
        <postamble></postamble>
      </figure>
  </t>

  <t> When a teardown of the session occurs, MAG-C1 will send a PBU with a
      lifetime value of zero.  The LMA-C sends a CONFIG message (1) to the
      Agent to modify the existing tunnel property of the existing Context to
      delete the tunnel information.) Upon reception of the CONFIG message,
      the Agent removes the tunnel configuration and responds to the Client (2).
      Per <xref target="RFC5213"/>, the PBA is sent back immediately after the
      PBA is received.</t>

  <t> If no valid PBA is received after the expiration of the
      MinDelayBeforeBCEDelete timer (see <xref target="RFC5213"/>),
      the LMA-C will send a CONFIG (3) message with a deletion request for
      the Context.  Upon reception of the message, the Agent deletes the tunnel
      and route on the DPN and responds to the Client (4).</t>

  <t> When a multi-DPN Agent is used the DPN list permits several DPNs to be
      provisioned in a single message for the single Conext.</t>
  <t>
    <figure anchor="fig_multidpn_example"
            title="Exemplary Message Sequence for Multi-DPN Agent">
        <artwork align="center"><![CDATA[

                        +-----------+           +-------+ +---------+
+------+ +------+     +-----+ FPC   |           | FPC   | |  Anchor |
|MAG-C1| |MAG-C2|     |LMA-C| Client|           | Agent | |   DPN1  |
+------+ +------+     +-----+-------+           +-------+ +---------+
[MN attach]  |            |                          |           |
   |-------------PBU----->|                          |           |
   |         |            |---(1)--CONFIG(CREATE)--->|           |
   |         |            |   [ MOBILTY_CONTEXT_ID,  |--tun1 up->|
   |         |            | DPNREFLIST:[[DPN1, BOTH  |           |
   |         |            |    DPN_SETTINGS_COMPL:[  |           |
   |         |            |   DOWNLINK(QOS/TUN),     |           |
   |         |            |   UPLINK(QOS/TUN) ] ],   |--tc qos-->|
   |         |            |    [DPN2, BOTH           |           |
   |         |            |    DPN_SETTINGS_COMPL:[  |           |
   |         |            |   DOWNLINK(QOS/TUN),     |           |
   |         |            |   UPLINK(QOS/TUN) ] ] ], |           |
   |         |            |   CTXT_SETTINGS_COMPL [  |           |
   |         |            |     IP_PREFIX(HNP) ] ]   |           |
   |         |            |<-(2)- OK_NOTIFY_FOLLOWS -|-route add>|
   |         |            |                          |           |
   |<------------PBA------|                          |           |
   |         |            |                          |           |
   | +----+               |                          |           |
   | |Edge|               |                          |           |
   | |DPN2|               |                          |           |
   | +----+               |                          |           |
   |   |<---------------------- tun1 up -------------|           |
   |   |<---------------------- tc qos --------------|           |
   |   |<---------------------- route add -----------|           |
   |   |                  |                          |           |
   |   |                  |<(3) CONFIG_RESULT_NOTIFY |           |
   |   |                  |   [ Response Data ]      |           |
   |   |                  |                          |           |
      ]]></artwork>
        <postamble></postamble>
      </figure>
  </t>
  <t> <xref target="fig_multidpn_example"/> shows how the first 2 messages in
      <xref target="fig_msc_example"/> are supported when a multi-DPN Agent
      communicates with both Anchor DPN1 and Edge DPN2.  In such a case, the
      FPC Client sends the downlink and uplink for both DPNs in the DPN Reference 
      List of the same Context. Message 1 shows the DPN Reference List with all entries.
      Each entry identifies the DPN and direction (one of 'uplink', 'downlink'
      or 'both').</t>

  <t> The Agent responds with an OK and NOTIFY_FOLLOWS indication while it simultaneoulsy
      provisions both DPNs. Upon successful completion, the Agent responds to
      the Client with a CONFIG_RESULT_NOTIFY indicating the operation status.
  </t>
  </section>

  <section anchor="policy_ex" title="Policy And Mobility on the Agent">

  <t> A Client may build Policy and Topology using any mechanism on the Agent.
      Such entities are not always required to be constructed in realtime and,
      therefore, there are no specific messages defined for them in this
      specification.</t>

  <t> The Client may add, modify or delete many Installed Policies and Contexts in a single
      FPC message. This includes linking Contexts to Actions and Descriptors,
      i.e. a Rule.  As example, a Rule which performs re-writing of an arriving
      packet's destination IP address from IP_A to IP_B matching an associated
      Descriptor, can be enforced in the Data-Plane via an Agent to implicitly
      consider matching arriving packet's source IP address against IP_B and
      re- write the source IP address to IP_A.
  </t>

  <t> <xref target="fig_port"/> illustrates the generic policy configuration
      model as used between a FPC Client and a FPC Agent.
  </t>

  <t>
     <figure anchor="fig_port" title="Structure of Policies and Vports">
        <artwork align="center"><![CDATA[

  Descriptor_1 -+          +- Action_1
                |          |
  Descriptor_2 -+--<Rule>--+- Action_2
                  +------+
                  /Order#/-------------+
                  +------+             |
                                       |
  Descriptor_3 -+          +- Action_3 +-<Policy>
                |          |           |  ^
  Descriptor_4 -+--<Rule>--+- Action_4 |  |
                  +------+             |  |
                  /Order#/-------------+  |
                  +------+                |
                                         <Intsalled-Policy>

  +-------------------+     +---------------------+
  | Bind 1..M traffic |     |  Bind 1..N traffic  |
  |  Descriptors to   | --> |  treatment actions  |
  |  to a Policy and  |     |   to a Policy and   |
  |  Installed-Policy |     |  Installed-Policy |
  +-------------------+     +---------------------+

 |                                                 |
 +-------------- Data-Plane Rule ------------------+
        ]]></artwork>
        <postamble></postamble>
      </figure>
  </t>

  <t>
   As depicted in <xref target="fig_port"/>, the Installed-Policy represents the anchor
   of Rules through the Policy / Rule hierarchy.  A Client and Agent use the identifier of the
   associated Policy to directly access the Rule and perform modifications of
   traffic Descriptors or Action references.  A Client and Agent use the
   identifiers to access the Descriptors or Actions to perform modifications.
   From the viewpoint of packet processing, arriving packets are matched
   against traffic Descriptors and processed according to the treatment
   Actions specified in the list of properties associated with the Installed-Policy.
  </t>
  <t>
   A Client complements a rule's Descriptors with a Rule's Order (priority)
   value to allow unambiguous traffic matching on the Data-Plane.
  </t>
  <t><xref target="fig_context"/> illustrates the generic context configuration
   model as used between a FPC Client and a FPC Agent.
  </t>

  <t>
      <figure anchor="fig_context" title="Structure of Contexts">
        <artwork align="center"><![CDATA[

  TrafficSelector_1
           |
  profile-parameters
           |
  mobility-profile-- dl ------+
                     ^        |
                     |      qos-profile
                <ContextID1>       |
                     ^        per-mn-agg-max-dl_2
                     |
                <ContextID2>

  +-------------------+     +---------------------+
  | Bind 1..M traffic |     |  Bind 1..N traffic  |
  |    selectors to   | --> |  treatment / qos    |
  |     a Context     |     |  actions to a       |
  |                   |     |       Context       |
  +-------------------+     +---------------------+

 |                                                 |
 +-------------- Data-Plane Rule ------------------+
        ]]></artwork>
        <postamble></postamble>
      </figure>
  </t>
  <t> As depicted in <xref target="fig_context"/>, the Context represents a
      mobility session hierarchy.  A Client and Agent directly assigns values
      such as downlink traffic descriptors, QoS information, etc.  A Client and
      Agent use the context identifiers to access the descriptors, qos
      information, etc. to perform modifications.  From the viewpoint of packet
      processing, arriving packets are matched against traffic Descriptors and
      processed according to the qos or other mobility profile related Actions
      specified in the Context's properties. If present, the final action is
      to use a Context's tunnel information to encapsulate and forward the
      packet.  </t>

  <t> A second Context also references context1 in the figure.  Based upon the
      technology a property in a parent context (parent mobility-context-id reference) MAY be inherited by its
      descendants.  This permits concise over the wire representation.  When a
      Client deletes a parent Context all children are also deleted.</t>
  </section>

  <section anchor="optimization"
           title="Optimization for Current and Subsequent Messages">
  <section anchor="bundelexample" title="Configuration Bundles">
    <t> Bundles provide transaction boundaries around work in a single
    message.  Operations in a bundle MUST be successfully executed in the
    order specified.  This allows references created in one operation to be
        used in a subsequent operation in the bundle. </t>
    <t> The example bundle shows in Operation 1 (OP 1) the creation of a
    Context 1 which is then referenced in Operation 2 (OP 2) by CONTEXT_ID
    2.  If OP 1 fails then OP 2 will not be executed.  The advantage of the
        CONF_BUNDLE is preservation of dependency orders in a single
    message as opposed to sending multiple CONFIG messages and awaiting
    results from the Agent.</t>
    <t> When a CONF_BUNDLE fails, any entities provisioned in the
    CURRENT operation are removed, however, any successful operations
    completed prior to the current operation are preserved in order to
    reduce system load.</t>
    <t>
      <figure anchor="fig_bundle_example"
              title="Exemplary Bundle Message (focus on FPC reference point)">
        <artwork align="center"><![CDATA[
                        +-------Router--------+
+-----------+           |+-------+ +---------+|
|   FPC     |            | FPC   | |  Anchor |
|  Client   |            | Agent | |   DPN   |
+-----------+            +-------+ +---------+
     |                          |           |
     |--CONF_BUNDLE(CREATE)---->|           |
     | [ OP 1,                  |           |
     |   [ MOBILTY_CONTEXT_ID 1,  |--tun1 up->|
     | DPNREFLIST:[[DPN1, BOTH  |           |
     |  DPN_SETTINGS_COMPL:[    |           |
     |   DOWNLINK(QOS/TUN),     |           |
     |   UPLINK(QOS/TUN)] ]]    |--tc qos-->|
     |   CTXT_SETTINGS_COMPL:[  |           |
     |     IP_PREFIX(HNP) ] ] ],|           |
     | [ OP 2,                  |           |
     |   [ MOBILTY_CONTEXT_ID,  |--tun1 up->|
     | DPNREFLIST:[[DPN1, BOTH  |           |
     |  DPN_SETTINGS_COMPL:[    |           |
     |   DOWNLINK(QOS/TUN),     |           |
     |   UPLINK(QOS/TUN)] ]]    |--tc qos-->|
     | PARENT_CONTEXT_ID_REF=1  |           |
     |  ] ]                     |           |
     |                          |           |
      ]]></artwork>
        <postamble></postamble>
      </figure>
    </t>
    </section>
    <section anchor="commandsetexample" title="Command Bitsets (Optional)">
    <t> Command Sets permit the ability to provide a single, unified data
    structure, e.g. Mobility-Context, and specify which activities are expected to
    be performed on the DPN.  This has some advantages
        <list style="symbols">
        <t> Rather than sending N messages with a single operation performed
        on the DPN a single message can be used with a Command Set that
        specifies the N DPN operations to be executed.</t>
        <t> Errors become more obvious.  For example, if the HNP is NOT
        provided but the Client did not specify that the HNP should be
        assigned by the Agent this error is easily detected.  Without the
        Command Set the default behavior of the Agent would be to assign
        the HNP and then respond back to the Client where the error would
        be detected and subsequent messaging would be required to remedy
        the error. Such situations can increase the time to error detection
        and overall system load without the Command Set present.</t>
        <t> Unambiguous provisioning specification.  The Agent is exactly in
        sync with the expectations of the Client as opposed to guessing
        what DPN work could be done based upon data present at the Agent.
        This greatly increases the speed by which the Agent can complete
        work.</t>
        <t> Permits different technologies with different instructions to be
        supported in FPC.</t>
        </list>
        </t>
    <t> As Command Bitsets are technology specific, e.g. PMIP or 3GPP Mobility,
    the type of work varies on the DPN and the amount of data present in a
    Context or Port will vary.  Using the technology specific instructions
    allows the Client to serve multiple technologies and MAY result in a
    more stateless Client as the instructions are transferred the Agent
    which will match the desired, technology specific instructions with
    the capabilities and over the wire protocol of the DPN more
    efficiently.</t>
    </section>

    <section anchor="referenceexample" title="Reference Scope(Optional)">
    <t> Although entities MAY refer to any other entity of an appropriate
    type, e.g. Contexts can refer to Policies or other Contexts, the Reference
    Scope gives the Agent an idea of where those references reside.  They
    may be in the same operation, an operation in the same CONF_BUNDLE
    message or in storage.  There may also be no references.  This permits
    the Agent to understand when it can stop searching for reference it
    cannot find.  For example, if a CONF_BUNDLE message uses a
    Reference Scope of type 'op' then it merely needs to keep an operation
    level cache and consume no memory or resources searching across the many
        operations in the CONF_BUNDLE message or the data store.</t>
    <t> Agents can also be stateless by only supporting the 'none', 'op' and
    'bundle' reference scopes.   This does not imply they lack storage but
    merely the search space they use when looking up references for an
    entity. The figure below shows the caching hierarchy provided by the
    Reference Scope</t>
    <t> Caches are temporarily created at each level and as the scope includes
    more caches the amount of entities that are searched increases.
    <xref target="fig_cache_example"/> shows an example containment hierarchy
      provided for all caches.</t>
    <t>
        <figure anchor="fig_cache_example"
              title="Exemplary Hierarchical Cache">
        <artwork align="center"><![CDATA[
                       +---------------+
                       | Global Cache  |
                       |  (storage)    |
                       +------+--------+
                              |
                              +----------------------+
                              |                      |
                       +------+--------+      +------+--------+
                       | Bundle Cache  |      | Bundle Cache  |
                       |   (bundle)    | .... |   (bundle)    |
                       +------+--------+      +------+--------+
                              |
         +--------------------+--------------------+
         |                    |                    |
+--------+---------+ +--------+---------+ +--------+---------+
| Operation Cache  | | Operation Cache  | | Operation Cache  |
|       (op)       | |       (op)       | |       (op)       |
+------------------+ +------------------+ +------------------+

                          (no cache)
      ]]></artwork>
        <postamble></postamble>
      </figure>
    </t>
    </section>

      <section anchor="registry" title="Basename Registry Feature (Optional)">
      <t> The Optional BaseName Registry support feature is provided to permit
      Clients and tenants with common scopes, referred to in this
      specification as BaseNames, to track the state of provisioned policy
      information on an Agent. The registry records the BaseName and
      Checkpoint set by a Client. If a new Client attaches to the Agent
      it can query the Registry to determine the amount of work that must
      be executed to configure the Agent to a BaseName / checkpoint
      revision. A State value is also provided in the registry to help
      Clients coordinate work on common BaseNames.</t>
      </section>
    </section>
  </section>
</section>

<section anchor="proto_message_detail" title="Protocol Message Details">
<section anchor="datastructure" title="Data Structures And Type Assignment">
<t>This section provides a type mapping for FPC structures.  When being mapped to a specific
information such as YANG the data type MAY change.</t>
<section anchor="policystructs" title="Policy Structures">
  <texttable anchor="policy-structs" title="Action Fields">
    <ttcol align="left">Structure</ttcol>
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
    <!-- Actions -->
      <c>ACTION</c>
      <c>ACTION_ID </c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>ACTION</c>
      <c>ACTION_TYPE</c>
      <c>[32, unsigned integer]</c>

      <c>ACTION</c>
      <c>ACTION_VALUE</c>
      <c>Type specific</c>

      <c>DESCRIPTOR</c>
      <c>DESCRIPTOR_ID </c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>DESCRIPTOR</c>
      <c>DESCRIPTOR_TYPE</c>
      <c>[32, unsigned integer]</c>

      <c>DESCRIPTOR</c>
      <c>DESCRIPTOR_VALUE</c>
      <c>Type specific</c>

    <!-- Policies -->
      <c>POLICY</c>
      <c>POLICY_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>POLICY</c>
      <c>RULES</c>
      <c>*[ PRECEDENCE RULE_ID ] PRECENDENCE is [32, unsigned integer].  For Rule see <xref target="rule_field"/></c>
  </texttable>
	
  <t> Policies contain a list of Rules by their order value. Each Rule contains
      Descriptors with optional directionality and Actions with order values
      that specifies action execution ordering if the Rule has multiple
      actions.</t>

  <t> Rules consist of the following fields.</t>
  <texttable anchor="rule_field" title="Rule Fields">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Sub-Fields</ttcol>
      <c>RULE_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>
      <c></c>
      
      <c>MATCH_TYPE</c>
      <c>ENUMERATION [2, unsigned bits]  
     ('AND' or 'OR')</c>
      <c></c>

      <c>RULE_DESCRIPTORS</c>
      <c>*[ DESCRIPTOR_ID DIRECTION ]</c>
      <c>DIRECTION [2, unsigned bits] is an ENUMERATION
     (uplink, downlink or both).</c>
      <c>RULE_ACTIONS</c>
      <c>*[ ACTION_ID ACTION_ORDER ]</c>
      <c>ACTION-ORDER [8, unsigned integer] specifies action execution order.</c>
  </texttable>
</section>

<section anchor="mobilitystructs" title="Mobility Structures">
  <texttable anchor="port_field" title="Installed-Policy Fields">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
      <c>DPN_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>
    
    
      <c>1*[ INSTALLED_POLICY_ID POLICY_ID_REFERENCE POLICY_SETTINGS ] DPN_POLICY_SETTINGS</c>
      <c></c>
    
      <c>INSTALLED_POLICY_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>
      
      <c>POLICY_ID_REFERENCE</c>
      <c>POLICY_ID</c>
      
      <c>POLICY_SETTINGS</c>
      <c>A collection of policy specific setings (properties)</c>
      
      <c>DPN_POLICY_SETTINGS</c>
      <c>A collection of setings (properties) that affect multiple installed policies.</c>
  </texttable>
  <texttable anchor="context_fields" title="Mobility Context Fields" >
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
      <c>MOBILITY_CONTEXT_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>DPN_GROUP_ID_REFERENCE</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>PARENT_MOBILITY_CONTEXT_ID_REFERNCE</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>DPNS [NOTE 2]</c>
      <c>*[  DPN_REFERENCE ]</c>

      <c>REQUEST_POLICY_REFERENCES</c>
      <c>* [ POLICY_ID ]</c>

      <c>CONTEXT_SETTINGS_COMPLEMENTARY</c>
      <c> A Collection of Settings (properties).</c>
  </texttable>

  <texttable anchor="dpn_ref_fields" title="DPN_REFERENCE Fields" >
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
      <c>DPN_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>DIRECTION</c>
      <c>See <xref target="rule_field"/></c>

      <c>INTERFACE_ID_REF</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>
      
      <c>EMBEDDED_RULES</c>
      <c>*[ EMBEDDED_RULE ]</c>

      <c>DPN_SETTINGS_COMPLEMENTARY</c>
      <c> A Collection of Settings (properties).</c>
      
      <c>ASSIGNED_POLICY_REFERENCES</c>
      <c>* [ POLICY_ID ]</c>
  </texttable>
  <texttable anchor="embedded_rule_fields" title="EMBEDDED_RULE Fields" >
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
      <c>RULE_ID</c>
      <c>FPC-Identity (<xref target="naming"/>)</c>

      <c>MATCH_TYPE</c>
      <c>See <xref target="rule_field"/></c>

      <c>PRECEDENCE</c>
      <c>See <xref target="policy-structs"/></c>
      
      <c>ACTION_DEFINITION_SET</c>
      <c>*[ ACTION_ORDER ACTION_ID ACTION_TYPE ACTION_VALUE ]</c>

      <c>DESCRIPTOR_DEFINITION_SET</c>
      <c> *[ DESCRIPTOR_ID DESCRIPTOR_TYPE DESCRIPTOR_VALUE ]</c>
  </texttable>

  <section anchor="mess_notifications" title="Monitors">
  <texttable anchor="monitor_structs" title="Monitor Structures and Attributes">
      <ttcol align="left">Field</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Description</ttcol>

      <c>MONITOR</c>
      <c>MONITOR_ID DETERRABLE TARGET BINDING_INFORMATION [REPORT_CONFIG]</c>
      <c></c>
      
      <c>DETERRABLE</c>
      <c>boolean</c>
      <c>Deterrability indicator.</c>
      
      <c>BINDING_INFORMATION</c>
      <c>String</c>
      <c></c>

      <c>MONITOR_ID</c>
      <c>FPC-Identity. See <xref target="naming"/></c>
      <c></c>

      <c>EVENT_TYPE_ID</c>
      <c>[8, Event Type ID]</c>
      <c>Event Type (unsigned integer).</c>

      <c>TARGET</c>
      <c>OCTET STRING (See <xref target="monitor_overview"/>)</c>
      <c></c>

      <c>REPORT_CONFIG</c>
      <c>[8, REPORT-TYPE] [TYPE_SPECIFIC_INFO]</c>
      <c></c>

      <c>PERIODIC_CONFIG</c>
      <c>[32, period]</c>
      <c>report interval (ms).</c>

      <c>THRESHOLD_CONFIG</c>
      <c>[32, low] [32, hi]</c>
      <c>thresholds (at least one value must be present)</c>

      <c>SCHEDULED_CONFIG</c>
      <c>[32, time]</c>
      <c></c>

      <c>EVENTS_CONFIG</c>
      <c>*[EVENT_TYPE_ID]</c>
      <c></c>
    </texttable>
    <t>TRIGGERS include but are not limited to the following values:
      <list style="symbols">
        <t>Events specified in the Event List of an EVENTS CONFIG</t>
        <t>LOW_THRESHOLD_CROSSED</t>
        <t>HIGH_THRESHOLD_CROSSED</t>
        <t>PERIODIC_REPORT</t>
        <t>SCHEDULED_REPORT</t>
        <t>PROBED</t>
        <t>DEREG_FINAL_VALUE</t>
      </list>
    </t>
  </section>
 </section>

 <section anchor="mess_attributes" title="Message Attributes">
  <section anchor="op-header" title="Header">
    <t>Each operation contains a header with the following fields:</t>
    <texttable anchor="op-header-tables" title="Message Header Fields">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Messages</ttcol>

    <c>CLIENT_ID</c>
    <c>FPC-Identity (<xref target="naming"/>)</c>
    <c>All</c>

    <c>DELAY</c>
    <c>[32, unsigned integer]</c>
    <c>All</c>

    <c>OP_ID</c>
    <c>[64, unsigned integer]</c>
    <c>All</c>
    
    <c>OP_REF_SCOPE</c>
    <c>[4, ENUMERATION]</c>
    <c>Values are none(0), op(1), bundle(2), storage(3) or unknown(4)</c>

    </texttable>
  </section>

  <section anchor="op-body"
       title="CONFIG and CONF_BUNDLE Attributes and Notifications">
    <texttable anchor="op_input" title="CONFIG and CONF_BUNDLE OP_BODY Fields">
      <ttcol align="left">Field</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Operation Types Create(C), Update(U),
              Query(Q) and Delete(D)</ttcol>

    <c>OP_TYPE</c>
    <c>[8, op type]</c>
    <c>CONFIG and CONF_BUNDLE</c>
    
      <c>COMMAND_SET</c>
      <c>FPC Command Bitset. See <xref target="commandsets"/>.</c>
      <c>C,U</c>

      <c>INSTALLED_POLICIES</c>
      <c>*[ INSTALLED_POLICY ]</c>
      <c>C,U</c>

      <c>MOBILITY-CONTEXTS</c>
      <c>*[ MOBILITY-CONTEXT [ COMMAND_SET [NOTE 1] ] ]</c>
      <c>C,U</c>

      <c>TARGETS</c>
      <c>FPC-Identity (<xref target="naming"/>) *[DPN_ID]</c>
      <c>Q,D</c>

      <c>POLICIES</c>
      <c>*[ POLICY ]</c>
      <c>C,U</c>
      
      <c>RULES</c>
      <c>*[ RULE ]</c>
      <c>C,U</c>

      <c>DESCRIPTORS</c>
      <c>*[ DESCRIPTOR ]</c>
      <c>C,U</c>

      <c>ACTIONS</c>
      <c>*[ ACTION ]</c>
      <c>C,U </c>
    </texttable>

    <texttable anchor="op_respbody"
           title="Immediate Response RESPONSE_BODY Fields">
      <ttcol align="left">Field</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Operation Types Create(C), Update(U),
              Query(Q) and Delete(D)</ttcol>

    <c>OP_ID</c>
    <c>[64, unsigned integer]</c>
    <c>All</c>
    
        <c>STATUS</c>
    <c>[1, Enumerated]</c>
    <c>OK(0) or Error(1)</c>
    
        <c>NOTIFY_FOLLOWS</c>
    <c>boolean</c>
    <c></c>

      <c>POLICIES</c>
      <c>*[ POLICY ]</c>
      <c>C,U</c>
      
      <c>RULES</c>
      <c>*[ RULE ]</c>
      <c>C,U</c>

      <c>DESCRIPTORS</c>
      <c>*[ DESCRIPTOR ]</c>
      <c>C,U</c>

      <c>ACTIONS</c>
      <c>*[ ACTION ]</c>
      <c>C,U </c>

      <c>INSTALLED_POLICIES</c>
      <c>*[ INSTALLED_POLICY ]</c>
      <c>C,U [NOTE 1]</c>

      <c>CONTEXTS</c>
      <c>*[ CONTEXT [ COMMAND_SET [NOTE 1] ] ]</c>
      <c>C,U [NOTE 1]</c>

      <c>TARGETS</c>
      <c>*[ FPC-Identity (<xref target="naming"/>) ]</c>
      <c>Q,D [NOTE 1]</c>

      <c>ERROR_TYPE_ID</c>
      <c>[32, unsigned integer]</c>
      <c>All [NOTE 2]</c>

      <c>ERROR_TAG</c>
      <c>[1024, octet string]</c>
      <c>All [NOTE 2, 3]</c>
    </texttable>
    <t>Notes:
      <list>
        <t> NOTE 1 - Present in OK and OK with NOTIFY_FOLLOWS for both CONFIG and
        CONF_BUNDLE. MAY also be present in an CONF_BUNDLE Error response
        (ERR) if one of the operations completed successfully.</t>
        <t> NOTE 2 - Present only for Error (ERR) responses.</t>
        <t> NOTE 3 - Other Error Info (Strings) MAY also be present.</t>
        </list>
    </t>

    <texttable anchor="ayncnotify_detail"
           title="CONFIG_RESULT_NOTIFY Asynchronous Notification Fields">
      <ttcol align="left">Field</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Description</ttcol>
      <c>AGENT_ID </c>
      <c>FPC-Identity (<xref target="naming"/>)</c>
      <c></c>

    <c>OP_ID</c>
    <c>[64, unsigned integer]</c>
    <c>All</c>
    
        <c>STATUS</c>
    <c>[1, Enumerated]</c>
    <c>OK(0) or Error(1)</c>

      <c>NOTIFICATION_ID </c>
      <c>[32, unsigned integer]</c>
      <c>A Notification Identifier used to determine notification order.</c>

      <c>TIMESTAMP</c>
      <c>[32, unsigned integer]</c>
      <c>The time that the notification occurred.</c>

      <c>DATA</c>
      <c>*[ [OP_ID (if CONF_BUNDLE) ] RESPONSE_BODY (<xref target="op_respbody"/>) ]</c>
      <c></c>
    </texttable>
  </section>

  <section anchor="mon_notifications" title="Monitors">
    <texttable anchor="notify_structs" title="Monitor Notifications">
      <ttcol align="left">Field</ttcol>
      <ttcol align="left">Type</ttcol>
      <ttcol align="left">Description</ttcol>

      <c>NOTIFICATION_ID</c>
      <c>[32, unsiged integer]</c>
      <c></c>

      <c>TIMESTAMP</c>
      <c>[32, unsigned integer]</c>
      <c></c>
      
      <c>CAUSE</c>
      <c>[32, unsigned integer]</c>
      <c></c>

      <c>NOTIFY</c>
      <c>MONITOR [NOTIFICATION_DATA]</c>
      <c>NOTIFICATION_DATA is the value of the monitored target if this is not ean error.</c>
    </texttable>
    </section>
  </section>
</section>
  
</section>

<section anchor="derived_attrs" title="Derived and Subtyped Attributes">
  <t>This section notes settings and derived attributes.</t>
  <texttable anchor="context_link_fields"
         title="Context Downlink/Uplink Field Definitions in Settings">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Detail</ttcol>
      <c>TUN_LOCAL_ADDRESS</c>
      <c>IP Address</c>
      <c>[NOTE 1]</c>

      <c>TUN_REMOTE_ADDRESS</c>
      <c>IP Address</c>
      <c>[NOTE 1]</c>

      <c>TUN_MTU</c>
      <c>[32, unsigned integer]</c>
      <c></c>

      <c>TUN_PAYLOAD_TYPE</c>
      <c>[2, bits]</c>
      <c>Enumeration: payload_ipv4(0), payload_ipv6(1) or payload_dual(2).</c>

      <c>TUN_TYPE</c>
      <c>[8, unsigned integer]</c>
      <c>Enumeration:  IP-in-IP(0), UDP(1), GRE(2) and GTP(3).</c>

      <c>TUN_IF</c>
      <c>[16, unsigned integer]</c>
      <c>Input interface index.</c>

      <c>MOBILITY_SPECIFIC_TUN_PARAMS</c>
      <c>[ IETF_PMIP_MOB_PROFILE |
           3GPP_MOB_PROFILE ]</c>
      <c>[NOTE 1]</c>

      <c>NEXTHOP</c>
      <c>[ IP Address | MAC Address | SPI | MPLS Label | SID | Interface Index ]
     (See <xref target="nexthop_subtypes"/>).</c>
      <c>[NOTE 1]</c>

      <c>QOS_PROFILE_PARAMS</c>
      <c>[ 3GPP_QOS | PMIP_QOS ]</c>
      <c>[NOTE 1]</c>

      <c>DPN_SPECIFIC_PARAMS</c>
      <c>[ TUN_IF or Varies]</c>
      <c>Specifies optional node specific parameters in need such as if-index,
     tunnel-if-number that must be unique in the DPN.</c>
      <postamble>
        NOTE 1 - These parameters are extensible.  The Types may be extended
    for Field value by future specifications or in the case of Vendor
    Specific Attributes by enterprises.
      </postamble>
  </texttable>
  <texttable anchor="descriptor_subtypes"
         title="Descriptor Subtypes" align="left">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>TO_PREFIX</c>
    <c>0</c>
    <c>[IP Address] [ Prefix Len ]</c>
    <c>Aggregated or per-host destination IP address/prefix descriptor.</c>

    <c>FROM_PREFIX</c>
    <c>1</c>
    <c>[IP Address] [ Prefix Len ]</c>
    <c>Aggregated or per-host source IP address/prefix descriptor.</c>

    <c>TRAFFIC_SELECTOR</c>
    <c>2</c>
    <c>Format per specification <xref target="RFC6088"/>.</c>
    <c>Traffic Selector.</c>
  </texttable>

  <texttable anchor="action_subtypes" title="Action Subtypes" align="left">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>DROP</c>
    <c>0</c>
    <c>Empty</c>
    <c>Drop the associated packets.</c>

    <c>REWRITE</c>
    <c>1</c>
    <c>[in_src_ip] [out_src_ip]
       [in_dst_ip] [out_dst_ip]
       [in_src_port] [out_src_port]
       [in_dst_port] [out_dst_port]</c>
    <c>Rewrite IP Address (NAT) or IP Address / Port (NAPT).</c>

    <c>COPY_FORWARD</c>
    <c>2</c>
    <c>FPC-Identity. See <xref target="naming"/>.</c>
    <c>Copy all packets and forward them to the provided identity.  The
       value of the identity MUST be a port or context.</c>
  </texttable>

  <texttable anchor="nexthop_subtypes" title="Next Hop Subtypes" align="left">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>IP_ADDR</c>
    <c>0</c>
    <c>IP Address</c>
    <c>An IP Address.</c>

    <c>MAC_ADDR</c>
    <c>1</c>
    <c>MAC Address</c>
    <c>A MAC Address.</c>

    <c>SERVICE_PATH_ID</c>
    <c>2</c>
    <c>[24, unsigned integer]</c>
    <c>Service Path Identifier (SPI)</c>

    <c>MPLS_LABEL</c>
    <c>3</c>
    <c>[20, unsigned integer]</c>
    <c>MPLS Label</c>

    <c>NSH</c>
    <c>4</c>
    <c>[SERVICE_PATH_ID] [8, unsigned integer]</c>
    <c>Included NSH which is a SPI and Service Index (8 bits).</c>

    <c>INTERFACE_INDEX</c>
    <c>5</c>
    <c>[16, unsigned integer]</c>
    <c>Interface Index (an unsigned integer).</c>

    <c>SEGMENT_ID</c>
    <c>6</c>
    <c>[128, unsigned integer]</c>
    <c>Segement Identifier.</c>
    
    <c>MPLS_LABEL_STACK</c>
    <c>7</c>
    <c>1*[MPLS_LABEL]</c>
    <c>MPLS Label</c>
    
    <c>SRV6_STACK</c>
    <c>8</c>
    <c>1*[IPv6 ADDR or PREFIX]</c>
    <c>SRv6 Stack</c>
  </texttable>

  <texttable anchor="qos_subtypes" title="QoS Subtypes" align="left">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>QOS</c>
    <c>0</c>
    <c>[qos index type] [index] [DSCP]</c>
    <c>Refers to a single index and DSCP to write to the packet.</c>

    <c>GBR</c>
    <c>1</c>
    <c>[32, unsigned integer]</c>
    <c>Guaranteed bit rate.</c>

    <c>MBR</c>
    <c>2</c>
    <c>[32, unsigned integer]</c>
    <c>Maximum bit rate.</c>

    <c>PMIP_QOS</c>
    <c>3</c>
    <c>Varies by Type</c>
    <c>A non-traffic selector PMIP QoS Attribute
    per <xref target="RFC7222"/></c>
  </texttable>

  <texttable anchor="tunnel_subtypes" title="Tunnel Subtypes" align="left">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Type</ttcol>
    <ttcol align="left">Description</ttcol>

    <c>IPIP_TUN</c>
    <c>0</c>
    <c></c>
    <c>IP in IP Configuration</c>

    <c>UDP_TUN</c>
    <c>1</c>
    <c>[src_port] [dst_port]</c>
    <c>UDP Tunnel - source and/or destination port</c>

    <c>GRE_TUN</c>
    <c>2</c>
    <c>[32, GRE Key]</c>
    <c>GRE Tunnel.</c>
  </texttable>

  <t>The following COMMAND_SET values are supported for IETF_PMIP.
    <list style="symbols">
      <t>assign-ip - Assign the IP Address for the mobile session.</t>
      <t>assign-dpn - Assign the Dataplane Node.</t>
      <t>session - Assign values for the Session Level.</t>
      <t>uplink - Command applies to uplink.</t>
      <t>downlink - Command applies to downlink.</t>
    </list>
  </t>

 <section anchor="thregpp" title="3GPP Specific Extenstions">
  <t> 3GPP support is optional and detailed in this section. The following
      acronyms are used:
   <list hangIndent="4" style="hanging">
    <t hangText="APN-AMBR:">Access Point Name Aggregate Maximum Bit Rate</t>
    <t hangText="ARP:">Allocation of Retention Priority </t>
    <t hangText="EBI:">EPS Bearer Identity </t>
    <t hangText="GBR:">Guaranteed Bit Rate</t>
    <t hangText="GTP:">GPRS (General Packet Radio Service)
            Tunneling Protocol</t>
    <t hangText="IMSI:">International Mobile Subscriber Identity</t>
    <t hangText="MBR:">Maximum Bit Rate</t>
    <t hangText="QCI:">QoS Class Identifier</t>
    <t hangText="TEID:">Tunnel Endpoint Identifier.</t>
    <t hangText="TFT:">Traffic Flow Template (TFT)</t>
    <t hangText="UE-AMBR:">User Equipment Aggregate Maximum Bit Rate </t>
   </list></t>
   <t>NOTE: GTP Sequence Number (SEQ_NUMBER) is used
        in failover and handover.</t>
  <texttable anchor="threegpp_attributes"
         title="3GPP Attributes and Structures">
    <ttcol align="left">Field</ttcol>
    <ttcol align="left">Type Value</ttcol>
    <ttcol align="left">Namespace / Entity Extended</ttcol>
    <ttcol align="left">Type</ttcol>

    <c>GTPV1</c>
    <c>3</c>
    <c>Tunnel Subtypes namespace.</c>
    <c>LOCAL_TEID REMOTE_TEID SEQ_NUMBER</c>

    <c>GTPV2</c>
    <c>4</c>
    <c>Tunnel Subtypes namespace.</c>
    <c>LOCAL_TEID REMOTE_TEID SEQ_NUMBER</c>

    <c>LOCAL_TEID</c>
    <c>N/A</c>
    <c>N/A</c>
    <c>[32, unisgned integer]</c>

    <c>REMOTE_TEID</c>
    <c>N/A</c>
    <c>N/A</c>
    <c>[32, unisgned integer]</c>

    <c>SEQ_NUMBER</c>
    <c>N/A</c>
    <c>N/A</c>
    <c>[32, unisgned integer]</c>

    <c>TFT</c>
    <c>3</c>
    <c>Descriptors Subtypes namespace.</c>
    <c>Format per TS 24.008 Section 10.5.6.12.</c>

    <c>IMSI</c>
    <c>N/A</c>
    <c>Context (new attribute)</c>
    <c>[64, unsigned integer]</c>

    <c>EBI</c>
    <c>N/A</c>
    <c>Context (new attribute)</c>
    <c>[4, unsigned integer]</c>

    <c>3GPP_QOS</c>
    <c>4</c>
    <c>QoS Subtypes namespace.</c>
    <c>[8, qci] [32, gbr] [32, mbr] [32, apn_ambr] [32, ue_ambr] ARP</c>

    <c>ARP</c>
    <c>N/A</c>
    <c>N/A</c>
    <c>See Allocation-Retention-Priority from <xref target="RFC7222"/></c>
  </texttable>

  <t>The following COMMAND_SET values are supported for 3GPP.
    <list style="symbols">
      <t> assign-ip - Assign the IP Address for the mobile session.</t>
      <t> assign-dpn - Assign the Dataplane Node.</t>
      <t> assign-fteid-ip - Assign the Fully Qualified TEID (F-TEID)
      LOCAL IP address.</t>
      <t> assign-fteid-teid - Assign the Fully Qualified TEID (F-TEID)
      LOCAL TEID.</t>
      <t> session - Assign values for the Session Level.  When this involves
      'assign-fteid-ip' and 'assign-fteid-teid' this implies the values are
      part of the default bearer.</t>
      <t> uplink - Command applies to uplink.</t>
      <t> downlink - Command applies to downlink.</t>
    </list>
  </t>
 </section>
</section>
<section title="Implementation Status">
  <t> Three FPC Agent implementations have been made to date.  The first was
      based upon Version 03 of the draft and followed Model 1.  The second
      follows Version 04 of the document. Both implementations were
      OpenDaylight plug-ins developed in Java by Sprint.   Version 03 was
      known as fpcagent and version 04's implementation is simply referred to
      as 'fpc'.  A third has been devloped on an ONOS Controller for use in MCORD
      projects.</t>
  <t> fpcagent's intent was to provide a proof of concept for FPC Version 03
      Model 1 in January 2016 and research various errors, corrections and
      optimizations that the Agent could make when supporting multiple DPNs.</t>
  <t> As the code developed to support OpenFlow and a proprietary DPN from a
      3rd party, several of the advantages of a multi-DPN Agent became obvious
      including the use of machine learning to reduce the number of Flows and
      Policy entities placed on the DPN.  This work has driven new efforts in
      the DIME WG, namely Diameter Policy Groups
      <xref target="I-D.bertz-dime-policygroups"/>.</t>
  <t> A throughput performance of tens per second using various NetConf based
      solutions in OpenDaylight made fpcagent undesirable for call processing.
      The RPC implementation improved throughput by an order of magnitude but
      was not useful based upon FPC's Version 03 design using two information
      models.  During this time the features of version 04 and its converged
      model became attractive and the fpcagent project was closed in August
      2016. fpcagent will no longer be developed and will remain a proprietary
      implementation.</t>
  <t> The learnings of fpcagent has influenced the second project, fpc. Fpc is
      also an OpenDaylight project but is an open source release
      as the Opendaylight FpcAgent plugin
      (https://wiki.opendaylight.org/view/Project_Proposals:FpcAgent).
      This project is scoped to be a fully compliant FPC Agent that supports
      multiple DPNs including those that communicate via OpenFlow. The following
      features present in this draft and others developed by the FPC development
      team have already lead to an order of magnitude improvement.
      <list hangIndent="4" style="hanging">
      <t> Migration of non-realtime provisioning of entities such as topology
      and policy allowed the implementation to focus only on the rpc.</t>
      <t> Using only 5 messages and 2 notifications has also reduced
      implementation time.</t>
      <t> Command Sets, an optional feature in this specification, have
      eliminated 80% of the time spent determining what needs to be done
      with a Context during a Create or Update operation.</t>
      <t> Op Reference is an optional feature modeled after video delivery.
      It has reduced unnecessary cache lookups.  It also has the additional
      benefit of allowing an Agent to become cacheless and effectively act
          as a FPC protocol adapter remotely with multi-DPN support or
      colocated on the DPN in a single-DPN support model.</t>
      <t> Multi-tenant support allows for Cache searches to be partitioned for
      clustering and performance improvements. This has not been
      capitalized upon by the current implementation but is part of the
      development roadmap.</t>
      <t> Use of Contexts to pre-provision policy has also eliminated any
      processing of Ports for DPNs which permitted the code for CONFIGURE
      and CONF_BUNDLE to be implemented as a simple nested FOR loops
      (see below).</t>
      </list>
  </t>

  <t> Initial v04 performance results without code optimizations or tuning allow
      2-5K FPC Contexts processed per second on a 2013 Mac laptop.  This
      results in 2x the number of transactions on the southbound interface to
      a proprietary DPN API on the same machine.</t>
    <t> Current v04 performance results without code optimizations or tuning allow
      1-2K FPC Contexts processed per second on a 2013 Mac laptop.  This
      results in 2x the number of transactions on the southbound interface to
      a proprietary DPN API on the same machine.</t>
  <t> fpc currently supports the following:
      <list hangIndent="24" style="hanging">
      <t> 1 proprietary DPN API</t>
      <t> Policy and Topology as defined in this specification using
      OpenDaylight North Bound Interfaces such as NetConf and RestConf</t>
      <t> CONFIG and CONF_BUNDLE (all operations)</t>
      <t> DPN assignment, Tunnel allocations and IPv4 address assignment
      by the Agent or Client.</t>
      <t> Immediate Response is always an OK_NOTIFY_FOLLOWS.</t>
      </list> </t>

  <t>
        <figure anchor="pseudo_code"
              title="fpc pseudo code">
        <artwork align="center"><![CDATA[
assignment system (receives rpc call):
  perform basic operation integrity check
  if CONFIG then
    goto assignments
    if assignments was ok then
      send request to activation system
      respond back to client with assignment data
    else
      send back error
    end if
  else if CONF_BUNDLE then
    for each operation in bundles
    goto assignments
    if assignments was ok then
      hold onto data
    else
      return error with the assignments that occurred in
        prior operations (best effort)
    end if
    end for
    send bundles to activation systems
  end if

assignments:
  assign DPN, IPv4 Address and/or tunnel info as required
  if an error occurs undo all assignments in this operation
  return result

activation system:
  build cache according to op-ref and operation type
  for each operation
    for each Context
      for each DPN / direction in Context
        perform actions on DPN according to Command Set
      end for
    end for
  end for
  commit changes to in memory cache
  log transaction for tracking and notification
                                (CONFIG_RESULT_NOTIFY)
      ]]></artwork>
    </figure>
  </t>

  <t> For further information please contact Lyle Bertz who is also a
      co-author of this document.</t>

  <t> NOTE: Tenant support requires binding a Client ID to a Tenant ID
      (it is a one to many relation) but that is outside of the scope of this
      specification.  Otherwise, the specification is complete in terms
      of providing sufficient information to implement an Agent.</t>
</section>


<section title="Security Considerations">

  <t> Detailed protocol implementations for DMM Forwarding Policy Configuration
      must ensure integrity of the information exchanged between an FPC Client
      and an FPC Agent. Required Security Associations may be derived from
      co-located functions, which utilize the FPC Client and FPC Agent
      respectively.</t>

  <t> The YANG modules defined in this memo is designed to be accessed
      via the NETCONF <xref target="RFC6241"/> or RESTCONF <xref target="RFC8040"/> protocol.  The lowest NETCONF
      layer is the secure transport layer and the mandatory-to-implement
      secure transport is SSH <xref target="RFC6242"/>.</t>

  <t> The information model defined in the memo is designed to be access by
      protocols specified in extensions to this document or, if using the YANG
      modules, as described above.</t>

  <t> There are a number of data nodes defined which are
      writable/creatable/deletable.  These data nodes may be considered
      sensitive or vulnerable in some network environments.  Write operations
      (e.g., a NETCONF edit-config) to these data nodes without proper
      protection can have a negative effect on network operations.  These
      are the subtrees and data nodes and their sensitivity/vulnerability:
      <list>
      <t> Nodes under the Policy tree provide generic policy enforcement and
      traffic classification.  They can be used to block or permit traffic.
      If this portion of the model was to be compromised it may be used to
      block, identify or permit traffic that was not intended by the Tenant
      or FPC CLient.</t>
      <t> Nodes under the Topology tree provide defintion of the Tenant's
      forwarding topology.  Any compromise of this information will provide
      topology information that could be used for subsequent attack
      vectors.  Removal of topology can limit services.</t>
      <t> Nodes under the Mobility Tree are runtime only and manipulated by
      remote procedure calls.  The unwanted deletion or removal of such
      information would deny users service or provide services to
      unauthorized parties.</t>
      </list> </t>

  <t> Some of the readable data nodes defined may be considered sensitive or
      vulnerable in some network environments.  It is thus important to control
      read access (e.g., via get, get-config, or notification) to these data
      nodes.  These are the subtrees and data nodes and their
      sensitivity/vulnerability:
      <list>
      <t> IP address assignments in the Context along with their associated
          tunnel configurations/identifiers (from the FPC base module)</t>
      <t> Internaional Mobile Subscriber Identity (IMSI) and bearer identifiers
          in the Context when using the optional 3GPP module</t>
      </list></t>

  <t> Some of the RPC operations defined may be considered sensitive or
      vulnerable in some network environments.  It is thus important to
      control access to these operations.  These are the operations and their
      sensitivity/vulnerability:
      <list>
      <t> CONFIG and CONF_BUNDLE send Context information which can include
          information of a sensitive or vulnerable nature in some network
      environments as described above.</t>
      <t> Monitor related RPC operations do not specicially provide sensitive
      or vulnerable informaiton but care must be taken by users to avoid
      identifier values that expose sensitive or vulnerable information.</t>
      <t> Notications MUST be treated with same level of protection and
      scrutiny as the operations they correspond to.  For example, a
      CONFIG_RESULT_NOTIFY notification provides the same information that
      is sent as part of the input and output of the CONFIG and CONF_BUNDLE
      RPC operations.</t>
      </list> </t>

  <t> General usage of FPC MUST consider the following:
      <list>
      <t> FPC Naming <xref target="naming"/> permits arbirtrary string values
      but a users MUST avoid placing sensitive or vulnerable information
      in those values.</t>
      <t> Policies that are very narrow and permit the identification of
      specific traffic, e.g. that of a single user, SHOULD be avoided.</t>
      </list></t>
</section>

<section anchor="IANA" title="IANA Considerations">
  <t>This document registers six URIs in the "IETF XML Registry"
   <xref target="RFC3688"/>.  Following the format in RFC 3688, the following
   registrations have been made.</t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-fpc
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-threegpp
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-pmip-qos
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-traffic-selector-types
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-fpc-policyext
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t><figure><artwork>
   URI: urn:ietf:params:xml:ns:yang:ietf-dmm-fpc-pmip
   Registrant Contact: The DMM WG of the IETF.
   XML: N/A, the requested URI is an XML namespace.</artwork></figure></t>

  <t>This document registers the following YANG modules in the "YANG
    Module Names" registry [RFC6020].</t>

  <t><figure><artwork>
  name:         ietf-dmm-fpc
  namespace:    urn:ietf:params:xml:ns:yang:ietf-dmm-fpc
  prefix:       fpc
  reference:    TBD1
  </artwork></figure></t>
  <t><figure><artwork>
  name:         ietf-dmm-threegpp
  namespace:    urn:ietf:params:xml:ns:yang:ietf-dmm-threegpp
  prefix:       threegpp
  reference:    TBD1
  </artwork></figure></t>
  <t><figure><artwork>
  name:         ietf-dmm-pmip-qos
  namespace:    urn:ietf:params:xml:ns:yang:ietf-dmm-pmip-qos
  prefix:       qos-pmip
  reference:    TBD1
  </artwork></figure></t>
  <t><figure><artwork>
  name:         ietf-dmm-traffic-selector-types
  namespace:    urn:ietf:params:xml:ns:yang:
    ietf-dmm-traffic-selector-types
  prefix:       traffic-selectors
  reference:    TBD1
  </artwork></figure></t>
  <t><figure><artwork>
  name:         ietf-dmm-traffic-selector-types
  namespace:    urn:ietf:params:xml:ns:yang:ietf-dmm-fpc-policyext
  prefix:       fpcpolicyext
  reference:    TBD1
  </artwork></figure></t>
  <t><figure><artwork>
  name:         ietf-dmm-traffic-selector-types
  namespace:    urn:ietf:params:xml:ns:yang:ietf-dmm-fpc-pmip
  prefix:       fpc-pmip
  reference:    TBD1
  </artwork></figure></t>


  <t>The document registers the following YANG submodules in the "YANG
   Module Names" registry [RFC6020].</t>
  <t><figure><artwork>
        name:         ietf-dmm-fpc-base
        parent:       ietf-dmm-fpc
        reference:    TBD1
  </artwork></figure></t>
</section>

<section title="Work Team Participants">

  <t> Participants in the FPSM work team discussion include Satoru Matsushima,
      Danny Moses, Sri Gundavelli, Marco Liebsch, Pierrick Seite, Alper Yegin,
      Carlos Bernardos, Charles Perkins and Fred Templin.</t>

</section>


</middle>

  <back>
    <references title="Normative References">
    &rfc2119;
    &RFC7333;
    &RFC6088;
    &RFC6089;
    &RFC6991;
    &I-D.ietf-sfc-nsh;
    &I-D.ietf-6man-segment-routing-header;
    &I-D.ietf-spring-segment-routing-mpls;

    </references>

    <references title="Informative References">
    &I-D.ietf-dmm-deployment-models;
    &I-D.ietf-netconf-restconf;
    &I-D.bertz-dime-policygroups;
    &RFC5213;
    &RFC7222;
    &RFC6241;
    &RFC6242;
    &RFC3688;
    &RFC8040;

</references>

<!--

<reference anchor="3GPP-PCRFFR" target="http://www.3gpp.org">
        <front>
            <title>3GPP TS 29.816  3GPP TS 29.272 Study on PRCF Failure and Restoration</title>
            <author initials="" surname="" fullname="">
                <organization />
            </author>
        </front>
    </reference>

<reference anchor="3GPP-DIAM" target="http://www.3gpp.org">
        <front>
            <title>3GPP TS 29.272  Mobility Management Entity (MME) and Serving
          GPRS Support Node (SGSN) related interfaces based on Diameter protocol </title>
            <author initials="" surname="" fullname="">
                <organization />
            </author>
        </front>
    </reference>


    </references>
-->

<section anchor="yangmodel" title="YANG Data Model for the FPC protocol">


<t>These modules define YANG definitions. 

When mapping from the FPC model was performed U-Key values, ACTION_TYPES and DESCRIPTOR_TYPES as 
well as many enumerations were mapped to identity types.  

ACTION_TYPES and DESCRIPTOR_TYPES are also optional as the type can be inferred from the value.

Four modules are defined:</t>

<t><list style="symbols">
<t>ietf-dmm-fpc (fpc) - Defines the base model and messages for FPC that are meant to be static in FPC.</t>
<t>ietf-dmm-fpc-settingsext An FPC module that defines the information model elements that 
are likely to be extended in FPC.</t>

<t>ietf-pmip-qos (pmip-qos) - Defines proxy mobile IPv6 QoS parameters per RFC 7222</t>
<t>ietf-traffic-selectors-types (traffic-selectors) - Defines Traffic Selectors per RFC 6088</t>

</list></t>

<!-- template for YANG model, start -->
  <section anchor="ietf-dmm-fpcagent" title="FPC YANG Model">
    <t>This module defines the information model and protocol elements specified in this document.</t>
    <t>This module references <xref target="RFC6991"/>, <xref target="RFC8040"/> and the fpc-settingsext module
      defined in this document.</t>
        <figure>
          <artwork><![CDATA[
<CODE BEGINS> file "ietf-dmm-fpc@2017-09-27.yang"

<CODE ENDS>]]></artwork>
        </figure>
  </section>

  <section anchor="yangmodels" title="YANG Models">
  <section anchor="description" title="FPC YANG Settings and Extensions Model">
    <t>This module defines the base data elements in FPC that are likely to be extended.</t>
    <t>This module references <xref target="RFC6991"/>, ietf-trafficselector-types and ietf-pmip-qos modules.</t>
        <figure>
          <artwork><![CDATA[
<CODE BEGINS> file "ietf-dmm-fpc-settingsext@2017-09-27.yang"

<CODE ENDS>]]></artwork>
        </figure>
</section>

  <section anchor="ietf-pmip-qos" title="PMIP QoS Model">
    <t>This module defines the base protocol elements specified in this document.</t>
    <t>This module references <xref target="RFC6991"/>.</t>
        <figure>
          <artwork><![CDATA[
<CODE BEGINS> file "ietf-pmip-qos@2017-10-29.yang"

<CODE ENDS>]]></artwork>
        </figure>
  </section>
  <section anchor="ietf-traffic-selectors-types" title="Traffic Selectors YANG Model">
<t>This module defines traffic selector types commonly used in Proxy Mobile IP (PMIP).</t>
    <t>This module references <xref target="RFC6991"/>.</t>
    <figure>
         <artwork><![CDATA[
<CODE BEGINS> file "ietf-traffic-selector-types@2017-10-29.yang"

<CODE ENDS>]]></artwork>
        </figure>
  </section>
<!-- template for YANG model, end -->
  </section>
  <section anchor="ietf-dmm-fpc-tree" title="FPC YANG Data Model Structure">
    <t>This section only shows the structure for FPC YANG model.</t>
<t>
 <figure anchor="fig-ietf-dmm-fpc-tree"
              title="YANG FPC Agent Tree">
<artwork align="center"><![CDATA[
module: ietf-dmm-fpc

     ]]></artwork>
        <postamble></postamble>
      </figure>
</t>
  </section>
</section>
  </back>
</rfc>
